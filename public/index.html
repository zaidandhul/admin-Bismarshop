<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BismarShop Admin - E-commerce Dashboard</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <style>
        /* Spacing seragam untuk kolom ACTIONS di seluruh tabel admin */
        td.action-buttons, th.action-buttons {
            white-space: nowrap;
            text-align: center;
            vertical-align: middle;
        }
        td.action-buttons .btn-group {
            gap: 2px;
        }
        td.action-buttons .btn {
            margin-inline: 1px;
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-red fixed-top">
        <div class="container-fluid">
            <a class="navbar-brand fw-bold" href="#">
                <img src="uploads/logo bulat.png" alt="PT Indobismar Logo" style="height: 32px; width: auto; margin-right: 8px;">BismarShop Admin
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-bs-toggle="dropdown">
                            <i class="fas fa-user-circle me-1"></i>Admir
                        </a>
                        <ul class="dropdown-menu">
                            <li><a class="dropdown-item" href="#" onclick="showSection('settings')"><i class="fas fa-cog me-2"></i>Settings</a></li>
                            <li><hr class="dropdown-divider"></li>
                            <li><a class="dropdown-item" href="#" onclick="logout()"><i class="fas fa-sign-out-alt me-2"></i>Logout</a></li>
                        </ul>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="container-fluid">
        <div class="row">
            <!-- Sidebar -->
            <nav class="col-md-3 col-lg-2 d-md-block bg-light sidebar collapse">
                <div class="sidebar-sticky">
                    <ul class="nav flex-column">
                        <li class="nav-item">
                            <a class="nav-link active" href="#" onclick="showSection('dashboard')">
                                <i class="fas fa-tachometer-alt me-2"></i>Dashboard
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#" onclick="showSection('products')">
                                <i class="fas fa-box me-2"></i>Products
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#" onclick="showSection('orders')">
                                <i class="fas fa-shopping-cart me-2"></i>Orders
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#" onclick="showSection('customers')">
                                <i class="fas fa-users me-2"></i>Customers
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#" onclick="showSection('vouchers')">
                                <i class="fas fa-ticket-alt me-2"></i>Vouchers
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#" onclick="showSection('flash-sales')">
                                <i class="fas fa-bolt me-2"></i>Flash Sales
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#" onclick="showSection('free-shipping')">
                                <i class="fas fa-shipping-fast me-2"></i>Gratis Ongkir
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#" onclick="showSection('product-vouchers')">
                                <i class="fas fa-tags me-2"></i>Voucher Produk
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#" onclick="showSection('reviews')">
                                <i class="fas fa-star me-2"></i>Ulasan
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#" onclick="showSection('analytics')">
                                <i class="fas fa-chart-bar me-2"></i>Analytics
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#" onclick="showSection('widgets')">
                                <i class="fas fa-image me-2"></i>Banner / Widget
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#" onclick="showSection('categories')">
                                <i class="fas fa-tags me-2"></i>Categories
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#" onclick="showSection('best-sellers')">
                                <i class="fas fa-trophy me-2"></i>Produk Terlaris
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#" onclick="showSection('settings')">
                                <i class="fas fa-cog me-2"></i>Settings
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#" onclick="showSection('admin-management')">
                                <i class="fas fa-user-shield me-2"></i>Kelola Admin & Staff
                            </a>
                        </li>
                    </ul>
                </div>
            </nav>

            <!-- Main content -->
            <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4 main-content">
                <!-- Dashboard Section -->
                <div id="dashboard" class="content-section">
                    <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                        <h1 class="h2">Dashboard</h1>
                        <div class="btn-toolbar mb-2 mb-md-0">
                            <div class="btn-group">
                                <button type="button" class="btn btn-sm btn-outline-primary" onclick="refreshDashboard()">
                                    <i class="fas fa-sync-alt me-1"></i> Refresh
                                </button>
                            </div>
                        </div>
                    </div>

                <!-- Widgets Section (Super Admin only) -->
                <div id="widgets" class="content-section" style="display: none;">
                    <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                        <h1 class="h2">
                            <i class="fas fa-image me-2 text-primary"></i>Banner / Widget Management
                        </h1>
                        <div class="btn-toolbar mb-2 mb-md-0">
                            <div class="btn-group me-2">
                                <button type="button" class="btn btn-sm btn-outline-secondary" onclick="loadWidgetsList()">
                                    <i class="fas fa-sync-alt"></i> Refresh
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Statistics Cards (hidden on widgets page) -->
                    <div class="row mb-4" style="display: none;">
                        <div class="col-md-3 col-sm-6 mb-3">
                            <div class="card bg-primary text-white h-100">
                                <div class="card-body">
                                    <div class="d-flex justify-content-between align-items-center">
                                        <div>
                                            <h6 class="card-title mb-1">Total Widgets</h6>
                                            <h4 class="mb-0" id="totalWidgetsCount">0</h4>
                                            <small>All items</small>
                                        </div>
                                        <i class="fas fa-images fa-2x opacity-75"></i>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3 col-sm-6 mb-3">
                            <div class="card bg-success text-white h-100">
                                <div class="card-body">
                                    <div class="d-flex justify-content-between align-items-center">
                                        <div>
                                            <h6 class="card-title mb-1">Active Widgets</h6>
                                            <h4 class="mb-0" id="activeWidgetsCount">0</h4>
                                            <small>Currently active</small>
                                        </div>
                                        <i class="fas fa-eye fa-2x opacity-75"></i>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3 col-sm-6 mb-3">
                            <div class="card bg-warning text-white h-100">
                                <div class="card-body">
                                    <div class="d-flex justify-content-between align-items-center">
                                        <div>
                                            <h6 class="card-title mb-1">Banners</h6>
                                            <h4 class="mb-0" id="bannersCount">0</h4>
                                            <small>Banner type</small>
                                        </div>
                                        <i class="fas fa-image fa-2x opacity-75"></i>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3 col-sm-6 mb-3">
                            <div class="card bg-info text-white h-100">
                                <div class="card-body">
                                    <div class="d-flex justify-content-between align-items-center">
                                        <div>
                                            <h6 class="card-title mb-1">Promotions</h6>
                                            <h4 class="mb-0" id="promotionsCount">0</h4>
                                            <small>Promo items</small>
                                        </div>
                                        <i class="fas fa-tags fa-2x opacity-75"></i>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <!-- Upload Form -->
                        <div class="col-lg-4 mb-4">
                            <div class="card shadow h-100">
                                <div class="card-header bg-gradient-primary text-white">
                                    <h5 class="card-title mb-0">
                                        <i class="fas fa-cloud-upload-alt me-2"></i>Upload New Widget
                                    </h5>
                                </div>
                                <div class="card-body">
                                    <form id="widgetUploadForm" onsubmit="submitWidgetUpload(event)" enctype="multipart/form-data">
                                        <div class="mb-3">
                                            <label for="widgetTitle" class="form-label fw-bold">
                                                <i class="fas fa-tag me-1 text-primary"></i>Widget Title
                                            </label>
                                            <input type="text" class="form-control form-control-lg" id="widgetTitle" 
                                                   placeholder="Enter descriptive title" required>
                                        </div>
                                        
                                        <div class="mb-3">
                                            <label for="widgetType" class="form-label fw-bold">
                                                <i class="fas fa-layer-group me-1 text-primary"></i>Widget Type
                                            </label>
                                            <select class="form-select form-select-lg" id="widgetType" required>
                                                <option value="widget" selected>üé® Widget</option>
                                                <option value="category">üè∑Ô∏è Category Image</option>
                                            </select>
                                        </div>
                                        <div class="mb-3">
                                            <label for="widgetCategory" class="form-label fw-bold">
                                                <i class="fas fa-tags me-1 text-primary"></i>Bind to Category (optional)
                                            </label>
                                            <select class="form-select form-select-lg" id="widgetCategory">
                                                <option value="">-- No Category (general widget) --</option>
                                                <option value="laptops">Laptop</option>
                                                <option value="smartphones">Handphone</option>
                                                <option value="tablets">Tablet</option>
                                                <option value="accessories">Accessories</option>
                                            </select>
                                            <small class="text-muted">Jika dipilih, gambar ini akan digunakan sebagai gambar kategori di aplikasi user.</small>
                                        </div>
                                        
                                        <div class="mb-4">
                                            <label for="widgetFile" class="form-label fw-bold">
                                                <i class="fas fa-image me-1 text-primary"></i>Image File
                                            </label>
                                            <div class="upload-area border-2 border-dashed border-primary rounded p-4 text-center">
                                                <input type="file" class="form-control d-none" id="widgetFile" 
                                                       accept="image/jpeg,image/jpg,image/png,image/webp,image/gif" required>
                                                <div id="uploadAreaContent">
                                                    <i class="fas fa-cloud-upload-alt fa-3x text-primary mb-3"></i>
                                                    <p class="mb-2">Click to select image or drag & drop</p>
                                                    <small class="text-muted">Max 5MB ‚Ä¢ JPG, PNG, WebP, GIF</small>
                                                </div>
                                                <div id="filePreview" class="d-none">
                                                    <img id="previewImage" src="" alt="Preview" class="img-fluid rounded mb-2" style="max-height: 150px;">
                                                    <p id="fileName" class="mb-0 text-truncate"></p>
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <div class="d-grid gap-2">
                                            <button type="submit" class="btn btn-primary btn-lg">
                                                <span id="uploadWidgetBtnText">
                                                    <i class="fas fa-upload me-2"></i>Upload Widget
                                                </span>
                                                <span id="uploadWidgetBtnLoading" class="d-none">
                                                    <i class="fas fa-spinner fa-spin me-2"></i>Uploading...
                                                </span>
                                            </button>
                                            <button type="button" class="btn btn-outline-secondary" onclick="resetUploadForm()">
                                                <i class="fas fa-times me-1"></i>Reset Form
                                            </button>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>

                        <!-- Widgets Display -->
                        <div class="col-lg-8">
                            <!-- Filter and Search -->
                            <div class="card shadow mb-3">
                                <div class="card-body py-2">
                                    <div class="row align-items-center">
                                        <div class="col-md-6">
                                            <div class="input-group">
                                                <span class="input-group-text"><i class="fas fa-search"></i></span>
                                                <input type="text" class="form-control" id="widgetSearch" 
                                                       placeholder="Search widgets..." onkeyup="filterWidgets()">
                                            </div>
                                        </div>
                                        <div class="col-md-4">
                                            <select class="form-select" id="statusFilter" onchange="filterWidgets()">
                                                <option value="">All Status</option>
                                                <option value="1">Active</option>
                                                <option value="0">Inactive</option>
                                            </select>
                                        </div>
                                        <div class="col-md-2">
                                            <button class="btn btn-outline-secondary w-100" onclick="clearWidgetFilters()">
                                                <i class="fas fa-times"></i> Clear
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Widgets Grid/Table Toggle -->
                            <div class="card shadow">
                                <div class="card-header py-3 d-flex justify-content-between align-items-center">
                                    <h6 class="m-0 font-weight-bold text-primary">
                                        <i class="fas fa-images me-2"></i>Widgets & Banners
                                        <span class="badge bg-secondary ms-2" id="widgetCountBadge">0</span>
                                    </h6>
                                    <div class="btn-group">
                                        <button class="btn btn-sm btn-outline-primary active" id="gridViewBtn" onclick="switchToGridView()">
                                            <i class="fas fa-th"></i> Grid
                                        </button>
                                        <button class="btn btn-sm btn-outline-primary" id="tableViewBtn" onclick="switchToTableView()">
                                            <i class="fas fa-list"></i> Table
                                        </button>
                                        <button class="btn btn-sm btn-outline-secondary" onclick="loadWidgetsList()">
                                            <i class="fas fa-sync-alt"></i>
                                        </button>
                                    </div>
                                </div>
                                <div class="card-body">
                                    <!-- Grid View -->
                                    <div id="widgetsGrid" class="row">
                                        <div class="col-12 text-center py-5">
                                            <div class="spinner-border text-primary" role="status">
                                                <span class="visually-hidden">Loading...</span>
                                            </div>
                                            <p class="mt-2 text-muted">Loading widgets...</p>
                                        </div>
                                    </div>

                                    <!-- Table View -->
                                    <div id="widgetsTableView" class="d-none">
                                        <div class="table-responsive">
                                            <table class="table table-hover" id="widgetsTable">
                                                <thead class="table-dark">
                                                    <tr>
                                                        <th width="60">Preview</th>
                                                        <th>Title</th>
                                                        <th width="100">Type</th>
                                                        <th width="80">Status</th>
                                                        <th width="100">Created</th>
                                                        <th width="120">Actions</th>
                                                    </tr>
                                                </thead>
                                                <tbody id="widgetsTableBody">
                                                    <tr>
                                                        <td colspan="6" class="text-center py-4">
                                                            <i class="fas fa-spinner fa-spin"></i> Loading widgets...
                                                        </td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Best Sellers Section -->
                <div id="best-sellers" class="content-section" style="display: none;">
                    <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                        <h1 class="h2"><i class="fas fa-trophy me-2"></i>Produk Terlaris</h1>
                    </div>
                    <div class="card shadow">
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table table-bordered" id="bestSellersTable">
                                    <thead>
                                        <tr>
                                            <th>Produk</th>
                                            <th>Kategori</th>
                                            <th>Terjual</th>
                                            <th>Pendapatan</th>
                                            <th>Aksi</th>
                                        </tr>
                                    </thead>
                                    <tbody id="bestSellersTableBody"></tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                    <!-- Sales Summary Cards -->
                    <div class="row mb-4">
                        <div class="col-md-4 mb-3">
                            <div class="card text-white shadow" style="background: linear-gradient(135deg, #dc2626 0%, #c53030 100%);">
                                <div class="card-body">
                                    <div class="d-flex justify-content-between">
                                        <div>
                                            <h6 class="card-title">Penjualan Hari Ini</h6>
                                            <h4 class="mb-0" id="todayRevenue">Rp 0</h4>
                                            <small id="todayOrders">0 pesanan</small>
                                        </div>
                                        <div class="align-self-center">
                                            <i class="fas fa-calendar-day fa-2x opacity-75"></i>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4 mb-3">
                            <div class="card text-white shadow" style="background: linear-gradient(135deg, #b91c1c 0%, #9b1c1c 100%);">
                                <div class="card-body">
                                    <div class="d-flex justify-content-between">
                                        <div>
                                            <h6 class="card-title">Penjualan Minggu Ini</h6>
                                            <h4 class="mb-0" id="weekRevenue">Rp 0</h4>
                                            <small id="weekOrders">0 pesanan</small>
                                        </div>
                                        <div class="align-self-center">
                                            <i class="fas fa-calendar-week fa-2x opacity-75"></i>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4 mb-3">
                            <div class="card text-white shadow" style="background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);">
                                <div class="card-body">
                                    <div class="d-flex justify-content-between">
                                        <div>
                                            <h6 class="card-title">Penjualan Bulan Ini</h6>
                                            <h4 class="mb-0" id="monthRevenue">Rp 0</h4>
                                            <small id="monthOrders">0 pesanan</small>
                                        </div>
                                        <div class="align-self-center">
                                            <i class="fas fa-calendar-alt fa-2x opacity-75"></i>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Order Status Cards -->
                    <div class="row mb-4">
                        <div class="col-xl-2-4 col-md-4 col-sm-6 mb-3">
                            <div class="card border-left-warning shadow h-100 py-2">
                                <div class="card-body">
                                    <div class="row no-gutters align-items-center">
                                        <div class="col mr-2">
                                            <div class="text-xs font-weight-bold text-warning text-uppercase mb-1">Pesanan Masuk</div>
                                            <div class="h5 mb-0 font-weight-bold text-gray-800" id="pendingOrdersCount">0</div>
                                        </div>
                                        <div class="col-auto">
                                            <i class="fas fa-clock fa-2x text-gray-300"></i>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-xl-2-4 col-md-4 col-sm-6 mb-3">
                            <div class="card border-left-primary shadow h-100 py-2">
                                <div class="card-body">
                                    <div class="row no-gutters align-items-center">
                                        <div class="col mr-2">
                                            <div class="text-xs font-weight-bold text-primary text-uppercase mb-1">Diproses</div>
                                            <div class="h5 mb-0 font-weight-bold text-gray-800" id="processingOrdersCount">0</div>
                                        </div>
                                        <div class="col-auto">
                                            <i class="fas fa-cog fa-2x text-gray-300"></i>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-xl-2-4 col-md-4 col-sm-6 mb-3">
                            <div class="card border-left-info shadow h-100 py-2">
                                <div class="card-body">
                                    <div class="row no-gutters align-items-center">
                                        <div class="col mr-2">
                                            <div class="text-xs font-weight-bold text-info text-uppercase mb-1">Dikirim</div>
                                            <div class="h5 mb-0 font-weight-bold text-gray-800" id="shippedOrdersCount">0</div>
                                        </div>
                                        <div class="col-auto">
                                            <i class="fas fa-shipping-fast fa-2x text-gray-300"></i>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-xl-2-4 col-md-4 col-sm-6 mb-3">
                            <div class="card border-left-success shadow h-100 py-2">
                                <div class="card-body">
                                    <div class="row no-gutters align-items-center">
                                        <div class="col mr-2">
                                            <div class="text-xs font-weight-bold text-success text-uppercase mb-1">Selesai</div>
                                            <div class="h5 mb-0 font-weight-bold text-gray-800" id="completedOrdersCount">0</div>
                                        </div>
                                        <div class="col-auto">
                                            <i class="fas fa-check-circle fa-2x text-gray-300"></i>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-xl-2-4 col-md-4 col-sm-6 mb-3">
                            <div class="card border-left-danger shadow h-100 py-2">
                                <div class="card-body">
                                    <div class="row no-gutters align-items-center">
                                        <div class="col mr-2">
                                            <div class="text-xs font-weight-bold text-danger text-uppercase mb-1">Dibatalkan</div>
                                            <div class="h5 mb-0 font-weight-bold text-gray-800" id="cancelledOrdersCount">0</div>
                                        </div>
                                        <div class="col-auto">
                                            <i class="fas fa-times-circle fa-2x text-gray-300"></i>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="row mb-4">
                        <!-- Best Selling Products -->
                        <div class="col-lg-6 mb-4">
                            <div class="card shadow">
                                <div class="card-header py-3">
                                    <h6 class="m-0 font-weight-bold text-primary">
                                        <i class="fas fa-trophy me-2"></i>Produk Terlaris
                                    </h6>
                                </div>
                                <div class="card-body">
                                    <div id="bestSellersContainer">
                                        <div class="text-center py-3">
                                            <div class="spinner-border text-primary" role="status">
                                                <span class="visually-hidden">Loading...</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Notifications -->
                        <div class="col-lg-6 mb-4">
                            <div class="card shadow">
                                <div class="card-header py-3 d-flex justify-content-between align-items-center">
                                    <h6 class="m-0 font-weight-bold text-primary">
                                        <i class="fas fa-bell me-2"></i>Notifikasi Terbaru
                                    </h6>
                                    <span class="badge bg-danger" id="notificationCount">0</span>
                                </div>
                                <div class="card-body" style="max-height: 400px; overflow-y: auto;">
                                    <div id="notificationsContainer">
                                        <div class="text-center py-3">
                                            <div class="spinner-border text-primary" role="status">
                                                <span class="visually-hidden">Loading...</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Recent Orders -->
                    <div class="card shadow mb-4">
                        <div class="card-header py-3">
                            <h6 class="m-0 font-weight-bold text-primary">
                                <i class="fas fa-list me-2"></i>Pesanan Terbaru
                            </h6>
                        </div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table table-bordered" id="recentOrdersTable">
                                    <thead>
                                        <tr>
                                            <th>Order ID</th>
                                            <th>Customer</th>
                                            <th>Amount</th>
                                            <th>Status</th>
                                            <th>Date</th>
                                        </tr>
                                    </thead>
                                    <tbody id="recentOrdersBody">
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Admin Management Section (Super Admin only) -->
                <div id="admin-management" class="content-section" style="display: none;">
                    <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                        <h1 class="h2"><i class="fas fa-user-shield me-2"></i>Kelola Admin & Staff</h1>
                    </div>
                    <div class="row">
                        <div class="col-lg-5 mb-4">
                            <div class="card shadow">
                                <div class="card-header d-flex justify-content-between align-items-center">
                                    <h6 class="mb-0"><i class="fas fa-user-plus me-2"></i>Buat Akun Baru</h6>
                                </div>
                                <div class="card-body">
                                    <form id="createAdminForm" onsubmit="submitCreateAdmin(event)">
                                        <div class="mb-3">
                                            <label for="createAdminName" class="form-label">Nama Lengkap</label>
                                            <input type="text" class="form-control" id="createAdminName" required>
                                        </div>
                                        <div class="mb-3">
                                            <label for="createAdminEmail" class="form-label">Email</label>
                                            <input type="email" class="form-control" id="createAdminEmail" required>
                                        </div>
                                        <div class="mb-3">
                                            <label for="createAdminPassword" class="form-label">Password</label>
                                            <input type="password" class="form-control" id="createAdminPassword" required>
                                        </div>
                                        <div class="mb-3">
                                            <label for="createAdminRole" class="form-label">Role</label>
                                            <select class="form-control" id="createAdminRole" required>
                                                <option value="">Pilih Role</option>
                                                <option value="1">Super Admin</option>
                                                <option value="2">Manager</option>
                                                <option value="3">Staff</option>
                                            </select>
                                        </div>
                                        <button type="submit" class="btn btn-primary" id="createAdminBtn">
                                            <span id="createAdminBtnText"><i class="fas fa-save me-2"></i>Simpan</span>
                                            <span id="createAdminBtnLoading" class="d-none"><i class="fas fa-spinner fa-spin me-2"></i>Menyimpan...</span>
                                        </button>
                                    </form>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-7 mb-4">
                            <div class="card shadow">
                                <div class="card-header d-flex justify-content-between align-items-center">
                                    <h6 class="mb-0"><i class="fas fa-users me-2"></i>Daftar Admin/Staff</h6>
                                    <button class="btn btn-sm btn-outline-secondary" onclick="loadAdminUsers()"><i class="fas fa-rotate me-1"></i>Muat Ulang</button>
                                </div>
                                <div class="card-body">
                                    <div class="row g-2 mb-3">
                                        <div class="col-md-4">
                                            <input type="text" class="form-control" id="userSearchQ" placeholder="Cari nama/email" onkeypress="if(event.key==='Enter') loadAdminUsers()">
                                        </div>
                                        <div class="col-md-3">
                                            <select class="form-control" id="userSearchRole" onchange="loadAdminUsers()">
                                                <option value="">Semua Role</option>
                                                <option value="1">Super Admin</option>
                                                <option value="2">Manager</option>
                                                <option value="3">Staff</option>
                                            </select>
                                        </div>
                                        <div class="col-md-3">
                                            <select class="form-control" id="userSearchStatus" onchange="loadAdminUsers()">
                                                <option value="">Semua Status</option>
                                                <option value="1">Active</option>
                                                <option value="0">Inactive</option>
                                            </select>
                                        </div>
                                        <div class="col-md-2 d-grid">
                                            <button class="btn btn-outline-primary" onclick="loadAdminUsers()"><i class="fas fa-search me-1"></i>Cari</button>
                                        </div>
                                    </div>
                                    <div class="table-responsive">
                                        <table class="table table-bordered">
                                            <thead>
                                                <tr>
                                                    <th>Nama</th>
                                                    <th>Email</th>
                                                    <th>Role</th>
                                                    <th>Status</th>
                                                    <th>Aksi</th>
                                                </tr>
                                            </thead>
                                            <tbody id="adminUsersTableBody"></tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Edit User Modal -->
                <div class="modal fade" id="editUserModal" tabindex="-1" aria-hidden="true">
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title"><i class="fas fa-user-edit me-2"></i>Edit Pengguna</h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                            </div>
                            <div class="modal-body">
                                <form id="editUserForm" onsubmit="submitEditUser(event)">
                                    <input type="hidden" id="editUserId">
                                    <div class="mb-3">
                                        <label class="form-label">Nama Lengkap</label>
                                        <input type="text" class="form-control" id="editUserName" required>
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label">Email</label>
                                        <input type="email" class="form-control" id="editUserEmail" required>
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label">Role</label>
                                        <select class="form-control" id="editUserRole" required>
                                            <option value="2">Manager</option>
                                            <option value="3">Staff</option>
                                            <option value="1">Super Admin</option>
                                        </select>
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label">Reset Password (opsional)</label>
                                        <input type="password" class="form-control" id="editUserPassword" minlength="6" placeholder="Kosongkan jika tidak diubah">
                                    </div>
                                </form>
                            </div>
                            <div class="modal-footer">
                                <button class="btn btn-secondary" data-bs-dismiss="modal">Batal</button>
                                <button class="btn btn-primary" onclick="document.getElementById('editUserForm').dispatchEvent(new Event('submit', {cancelable: true}))">
                                    <span id="editUserBtnText"><i class="fas fa-save me-2"></i>Simpan</span>
                                    <span id="editUserBtnLoading" class="d-none"><span class="spinner-border spinner-border-sm me-2"></span>Menyimpan...</span>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Products Section -->
                <div id="products" class="content-section" style="display: none;">
                    <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                        <h1 class="h2">Products Management</h1>
                        <button class="btn btn-primary" onclick="showProductModal()">
                            <i class="fas fa-plus me-2"></i>Add Product
                        </button>
                    </div>

                    <div class="card shadow">
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table table-bordered">
                                    <thead>
                                        <tr>
                                            <th>Images</th>
                                            <th>Name</th>
                                            <th>Description</th>
                                            <th>Category</th>
                                            <th>Regular Price</th>
                                            <th>Promo Price</th>
                                            <th>Stock</th>
                                            <th>Variants</th>
                                            <th>Status</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody id="productsTableBody">
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Orders Section -->
                <div id="orders" class="content-section" style="display: none;">
                    <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                        <h1 class="h2">Orders Management</h1>
                    </div>

                    <div class="card shadow">
                        <div class="card-body">
                            <div class="row g-3 mb-3" id="ordersToolbar">
                                <div class="col-md-4">
                                    <label class="form-label" for="ordersSearch">Search Orders</label>
                                    <input type="text" class="form-control" id="ordersSearch" placeholder="Cari order id, customer, email, alamat...">
                                </div>
                                <div class="col-md-3">
                                    <label class="form-label" for="ordersStatusFilter">Filter Status</label>
                                    <select class="form-select" id="ordersStatusFilter">
                                        <option value="">Semua Status</option>
                                        <option value="pending">Pending</option>
                                        <option value="processing">Processing</option>
                                        <option value="shipped">Shipped</option>
                                        <option value="completed">Completed</option>
                                        <option value="canceled">Canceled</option>
                                    </select>
                                </div>
                                <div class="col-md-3">
                                    <label class="form-label" for="ordersSortBy">Sort By</label>
                                    <select class="form-select" id="ordersSortBy">
                                        <option value="id_desc">Order ID (Newest)</option>
                                        <option value="id_asc">Order ID (Oldest)</option>
                                        <option value="total_desc">Total Amount (Highest)</option>
                                        <option value="total_asc">Total Amount (Lowest)</option>
                                    </select>
                                </div>
                                <div class="col-md-2 d-flex align-items-end">
                                    <button type="button" class="btn btn-outline-secondary w-100" id="ordersClearFilters">Clear</button>
                                </div>
                            </div>
                            <div class="table-responsive">
                                <table class="table table-bordered">
                                    <thead>
                                        <tr>
                                            <th>Order ID</th>
                                            <th>Customer</th>
                                            <th>Email</th>
                                            <th>Address</th>
                                            <th>Total Amount</th>
                                            <th>Status</th>
                                            <th>Date</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody id="ordersTableBody">
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Customers Section -->
                <div id="customers" class="content-section" style="display: none;">
                    <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                        <h1 class="h2">Customers Management</h1>
                        <div class="btn-toolbar mb-2 mb-md-0">
                            <div class="btn-group me-2">
                                <button type="button" class="btn btn-sm btn-outline-secondary" onclick="loadCustomers()">
                                    <i class="fas fa-sync-alt"></i> Refresh
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Statistics Cards -->
                    <div class="row mb-4">
                        <div class="col-md-3 col-sm-6 mb-3">
                            <div class="card bg-primary text-white h-100">
                                <div class="card-body">
                                    <div class="d-flex justify-content-between align-items-center">
                                        <div>
                                            <h6 class="card-title mb-1">Total Customers</h6>
                                            <h4 class="mb-0" id="totalCustomersCount">0</h4>
                                            <small>All registered</small>
                                        </div>
                                        <i class="fas fa-users fa-2x opacity-75"></i>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3 col-sm-6 mb-3">
                            <div class="card bg-success text-white h-100">
                                <div class="card-body">
                                    <div class="d-flex justify-content-between align-items-center">
                                        <div>
                                            <h6 class="card-title mb-1">Active Customers</h6>
                                            <h4 class="mb-0" id="activeCustomersCount">0</h4>
                                            <small>Currently active</small>
                                        </div>
                                        <i class="fas fa-user-check fa-2x opacity-75"></i>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3 col-sm-6 mb-3">
                            <div class="card bg-warning text-white h-100">
                                <div class="card-body">
                                    <div class="d-flex justify-content-between align-items-center">
                                        <div>
                                            <h6 class="card-title mb-1">Inactive Customers</h6>
                                            <h4 class="mb-0" id="inactiveCustomersCount">0</h4>
                                            <small>Not active</small>
                                        </div>
                                        <i class="fas fa-user-times fa-2x opacity-75"></i>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3 col-sm-6 mb-3">
                            <div class="card bg-danger text-white h-100">
                                <div class="card-body">
                                    <div class="d-flex justify-content-between align-items-center">
                                        <div>
                                            <h6 class="card-title mb-1">Banned Customers</h6>
                                            <h4 class="mb-0" id="bannedCustomersCount">0</h4>
                                            <small>Restricted access</small>
                                        </div>
                                        <i class="fas fa-user-slash fa-2x opacity-75"></i>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Search and Filter -->
                    <div class="card shadow mb-4">
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-4 mb-3">
                                    <label for="customerSearch" class="form-label">Search Customers</label>
                                    <input type="text" class="form-control" id="customerSearch" placeholder="Search by name, email, or phone..." onkeyup="filterCustomers()">
                                </div>
                                <div class="col-md-3 mb-3">
                                    <label for="customerStatusFilter" class="form-label">Filter by Status</label>
                                    <select class="form-select" id="customerStatusFilter" onchange="filterCustomers()">
                                        <option value="">All Status</option>
                                        <option value="active">Active</option>
                                        <option value="inactive">Inactive</option>
                                        <option value="banned">Banned</option>
                                    </select>
                                </div>
                                <div class="col-md-3 mb-3">
                                    <label for="sortBy" class="form-label">Sort By</label>
                                    <select class="form-select" id="sortBy" onchange="sortCustomers()">
                                        <option value="name">Name (A-Z)</option>
                                        <option value="name_desc">Name (Z-A)</option>
                                        <option value="joined_date">Joined Date (Newest)</option>
                                        <option value="joined_date_desc">Joined Date (Oldest)</option>
                                        <option value="total_spent">Total Spent (Highest)</option>
                                        <option value="total_spent_desc">Total Spent (Lowest)</option>
                                    </select>
                                </div>
                                <div class="col-md-2 mb-3">
                                    <label class="form-label">&nbsp;</label>
                                    <button type="button" class="btn btn-outline-secondary w-100" onclick="clearFilters()">
                                        <i class="fas fa-times"></i> Clear
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Customers Table -->
                    <div class="card shadow">
                        <div class="card-header">
                            <h5 class="mb-0">
                                <i class="fas fa-users me-2"></i>Customer List
                                <span class="badge bg-secondary ms-2" id="customerCountBadge">0</span>
                            </h5>
                        </div>
                        <div class="card-body">
                            <div class="table-responsive customers-table-responsive">
                                <table class="table table-hover table-striped">
                                    <thead class="table-dark">
                                        <tr>
                                            <th class="text-nowrap">
                                                <i class="fas fa-user me-1"></i>Name
                                            </th>
                                            <th class="text-nowrap d-none d-md-table-cell">
                                                <i class="fas fa-envelope me-1"></i>Email
                                            </th>
                                            <th class="text-nowrap d-none d-lg-table-cell">
                                                <i class="fas fa-phone me-1"></i>Phone
                                            </th>
                                            
                                            <th class="text-nowrap d-none d-sm-table-cell text-center">
                                                <i class="fas fa-shopping-cart me-1"></i>Orders
                                            </th>
                                            <th class="text-nowrap d-none d-md-table-cell text-end">
                                                <i class="fas fa-money-bill-wave me-1"></i>Total Spent
                                            </th>
                                            <th class="text-nowrap text-center">
                                                <i class="fas fa-toggle-on me-1"></i>Status
                                            </th>
                                            <th class="text-nowrap d-none d-lg-table-cell text-center">
                                                <i class="fas fa-calendar me-1"></i>Joined
                                            </th>
                                            <th class="text-nowrap text-center">
                                                <i class="fas fa-cogs me-1"></i>Actions
                                            </th>
                                        </tr>
                                    </thead>
                                    <tbody id="customersTableBody">
                                        <tr>
                                            <td colspan="8" class="text-center py-4">
                                                <div class="spinner-border text-primary" role="status">
                                                    <span class="visually-hidden">Loading...</span>
                                                </div>
                                                <div class="mt-2">Loading customers...</div>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                            
                            <!-- Pagination -->
                            <div class="d-flex justify-content-between align-items-center mt-3">
                                <div class="text-muted">
                                    Showing <span id="showingFrom">0</span> to <span id="showingTo">0</span> of <span id="totalCustomers">0</span> customers
                                </div>
                                <nav aria-label="Customers pagination">
                                    <ul class="pagination pagination-sm mb-0" id="customersPagination">
                                        <!-- Pagination will be generated by JavaScript -->
                                    </ul>
                                </nav>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Vouchers Section -->
                <div id="vouchers" class="content-section" style="display: none;">
                    <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                        <h1 class="h2"><i class="fas fa-ticket-alt me-2"></i>Vouchers Management</h1>
                        <button class="btn btn-primary" onclick="showVoucherModal()">
                            <i class="fas fa-plus me-2"></i>Add Voucher
                        </button>
                    </div>

                    <!-- Vouchers Stats Cards -->
                    <div class="row mb-4">
                        <div class="col-md-3">
                            <div class="card border-left-primary shadow h-100 py-2">
                                <div class="card-body">
                                    <div class="row no-gutters align-items-center">
                                        <div class="col mr-2">
                                            <div class="text-xs font-weight-bold text-primary text-uppercase mb-1">Total Vouchers</div>
                                            <div class="h5 mb-0 font-weight-bold text-gray-800" id="totalVouchersCount">0</div>
                                        </div>
                                        <div class="col-auto">
                                            <i class="fas fa-ticket-alt fa-2x text-gray-300"></i>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="card border-left-success shadow h-100 py-2">
                                <div class="card-body">
                                    <div class="row no-gutters align-items-center">
                                        <div class="col mr-2">
                                            <div class="text-xs font-weight-bold text-success text-uppercase mb-1">Active Vouchers</div>
                                            <div class="h5 mb-0 font-weight-bold text-gray-800" id="activeVouchersCount">0</div>
                                        </div>
                                        <div class="col-auto">
                                            <i class="fas fa-check-circle fa-2x text-gray-300"></i>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="card border-left-info shadow h-100 py-2">
                                <div class="card-body">
                                    <div class="row no-gutters align-items-center">
                                        <div class="col mr-2">
                                            <div class="text-xs font-weight-bold text-info text-uppercase mb-1">Total Usage</div>
                                            <div class="h5 mb-0 font-weight-bold text-gray-800" id="totalVoucherUsage">0</div>
                                        </div>
                                        <div class="col-auto">
                                            <i class="fas fa-chart-line fa-2x text-gray-300"></i>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="card border-left-warning shadow h-100 py-2">
                                <div class="card-body">
                                    <div class="row no-gutters align-items-center">
                                        <div class="col mr-2">
                                            <div class="text-xs font-weight-bold text-warning text-uppercase mb-1">Expired Soon</div>
                                            <div class="h5 mb-0 font-weight-bold text-gray-800" id="expiringSoonCount">0</div>
                                        </div>
                                        <div class="col-auto">
                                            <i class="fas fa-exclamation-triangle fa-2x text-gray-300"></i>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="card shadow">
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table table-bordered">
                                    <thead>
                                        <tr>
                                            <th>Code</th>
                                            <th>Name</th>
                                            <th>Type</th>
                                            <th>Value</th>
                                            <th>Min Purchase</th>
                                            <th>Usage</th>
                                            <th>Start Date</th>
                                            <th>End Date</th>
                                            <th>Status</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody id="vouchersTableBody">
                                        <tr>
                                            <td colspan="10" class="text-center">
                                                <div class="spinner-border text-primary" role="status">
                                                    <span class="visually-hidden">Loading...</span>
                                                </div>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Flash Sales Section -->
                <div id="flash-sales" class="content-section" style="display: none;">
                    <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                        <h1 class="h2"><i class="fas fa-bolt me-2"></i>Flash Sales Management</h1>
                        <button class="btn btn-primary" onclick="showFlashSaleModal()">
                            <i class="fas fa-plus me-2"></i>Add Flash Sale
                        </button>
                    </div>

                    <!-- Flash Sales Stats Cards -->
                    <div class="row mb-4">
                        <div class="col-md-4">
                            <div class="card border-left-danger shadow h-100 py-2">
                                <div class="card-body">
                                    <div class="row no-gutters align-items-center">
                                        <div class="col mr-2">
                                            <div class="text-xs font-weight-bold text-danger text-uppercase mb-1">Active Flash Sales</div>
                                            <div class="h5 mb-0 font-weight-bold text-gray-800" id="activeFlashSalesCount">0</div>
                                        </div>
                                        <div class="col-auto">
                                            <i class="fas fa-bolt fa-2x text-gray-300"></i>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="card border-left-warning shadow h-100 py-2">
                                <div class="card-body">
                                    <div class="row no-gutters align-items-center">
                                        <div class="col mr-2">
                                            <div class="text-xs font-weight-bold text-warning text-uppercase mb-1">Scheduled</div>
                                            <div class="h5 mb-0 font-weight-bold text-gray-800" id="scheduledFlashSalesCount">0</div>
                                        </div>
                                        <div class="col-auto">
                                            <i class="fas fa-clock fa-2x text-gray-300"></i>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="card border-left-success shadow h-100 py-2">
                                <div class="card-body">
                                    <div class="row no-gutters align-items-center">
                                        <div class="col mr-2">
                                            <div class="text-xs font-weight-bold text-success text-uppercase mb-1">Completed</div>
                                            <div class="h5 mb-0 font-weight-bold text-gray-800" id="completedFlashSalesCount">0</div>
                                        </div>
                                        <div class="col-auto">
                                            <i class="fas fa-check-circle fa-2x text-gray-300"></i>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="card shadow">
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table table-bordered">
                                    <thead>
                                        <tr>
                                            <th>Name</th>
                                            <th>Time Period</th>
                                            <th>Discount %</th>
                                            <th>Stock</th>
                                            <th>Auto Apply</th>
                                            <th>Status</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody id="flashSalesTableBody">
                                        <tr>
                                            <td colspan="7" class="text-center">
                                                <div class="spinner-border text-primary" role="status">
                                                    <span class="visually-hidden">Loading...</span>
                                                </div>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Free Shipping Section -->
                <div id="free-shipping" class="content-section" style="display: none;">
                    <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                        <h1 class="h2"><i class="fas fa-shipping-fast me-2"></i>Gratis Ongkir Management</h1>
                        <button class="btn btn-primary" onclick="showFreeShippingModal()">
                            <i class="fas fa-plus me-2"></i>Add Gratis Ongkir
                        </button>
                    </div>

                    <!-- Free Shipping Stats Cards -->
                    <div class="row mb-4">
                        <div class="col-md-3">
                            <div class="card border-left-success shadow h-100 py-2">
                                <div class="card-body">
                                    <div class="row no-gutters align-items-center">
                                        <div class="col mr-2">
                                            <div class="text-xs font-weight-bold text-success text-uppercase mb-1">Active Free Shipping</div>
                                            <div class="h5 mb-0 font-weight-bold text-gray-800" id="activeFreeShippingCount">0</div>
                                        </div>
                                        <div class="col-auto">
                                            <i class="fas fa-shipping-fast fa-2x text-gray-300"></i>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="card border-left-info shadow h-100 py-2">
                                <div class="card-body">
                                    <div class="row no-gutters align-items-center">
                                        <div class="col mr-2">
                                            <div class="text-xs font-weight-bold text-info text-uppercase mb-1">Total Promotions</div>
                                            <div class="h5 mb-0 font-weight-bold text-gray-800" id="totalFreeShippingCount">0</div>
                                        </div>
                                        <div class="col-auto">
                                            <i class="fas fa-gift fa-2x text-gray-300"></i>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="card border-left-warning shadow h-100 py-2">
                                <div class="card-body">
                                    <div class="row no-gutters align-items-center">
                                        <div class="col mr-2">
                                            <div class="text-xs font-weight-bold text-warning text-uppercase mb-1">Total Savings</div>
                                            <div class="h5 mb-0 font-weight-bold text-gray-800" id="totalShippingSavings">Rp 0</div>
                                        </div>
                                        <div class="col-auto">
                                            <i class="fas fa-money-bill-wave fa-2x text-gray-300"></i>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="card border-left-primary shadow h-100 py-2">
                                <div class="card-body">
                                    <div class="row no-gutters align-items-center">
                                        <div class="col mr-2">
                                            <div class="text-xs font-weight-bold text-primary text-uppercase mb-1">Usage Count</div>
                                            <div class="h5 mb-0 font-weight-bold text-gray-800" id="freeShippingUsageCount">0</div>
                                        </div>
                                        <div class="col-auto">
                                            <i class="fas fa-chart-line fa-2x text-gray-300"></i>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="card shadow">
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table table-bordered">
                                    <thead>
                                        <tr>
                                            <th>Name</th>
                                            <th>Min Purchase</th>
                                            <th>Max Discount</th>
                                            <th>Coverage</th>
                                            <th>Period</th>
                                            <th>Usage</th>
                                            <th>Status</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody id="freeShippingTableBody">
                                        <tr>
                                            <td colspan="8" class="text-center">
                                                <div class="spinner-border text-primary" role="status">
                                                    <span class="visually-hidden">Loading...</span>
                                                </div>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Product Vouchers Section -->
                <div id="product-vouchers" class="content-section" style="display: none;">
                    <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                        <h1 class="h2"><i class="fas fa-tags me-2"></i>Voucher Produk Management</h1>
                        <button class="btn btn-primary" onclick="showProductVoucherModal()">
                            <i class="fas fa-plus me-2"></i>Add Voucher Produk
                        </button>
                    </div>

                    <!-- Product Vouchers Stats Cards -->
                    <div class="row mb-4">
                        <div class="col-md-3">
                            <div class="card border-left-primary shadow h-100 py-2">
                                <div class="card-body">
                                    <div class="row no-gutters align-items-center">
                                        <div class="col mr-2">
                                            <div class="text-xs font-weight-bold text-primary text-uppercase mb-1">Active Product Vouchers</div>
                                            <div class="h5 mb-0 font-weight-bold text-gray-800" id="activeProductVouchersCount">0</div>
                                        </div>
                                        <div class="col-auto">
                                            <i class="fas fa-tags fa-2x text-gray-300"></i>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="card border-left-success shadow h-100 py-2">
                                <div class="card-body">
                                    <div class="row no-gutters align-items-center">
                                        <div class="col mr-2">
                                            <div class="text-xs font-weight-bold text-success text-uppercase mb-1">Category Vouchers</div>
                                            <div class="h5 mb-0 font-weight-bold text-gray-800" id="categoryVouchersCount">0</div>
                                        </div>
                                        <div class="col-auto">
                                            <i class="fas fa-layer-group fa-2x text-gray-300"></i>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="card border-left-info shadow h-100 py-2">
                                <div class="card-body">
                                    <div class="row no-gutters align-items-center">
                                        <div class="col mr-2">
                                            <div class="text-xs font-weight-bold text-info text-uppercase mb-1">Product Specific</div>
                                            <div class="h5 mb-0 font-weight-bold text-gray-800" id="productSpecificVouchersCount">0</div>
                                        </div>
                                        <div class="col-auto">
                                            <i class="fas fa-box fa-2x text-gray-300"></i>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="card border-left-warning shadow h-100 py-2">
                                <div class="card-body">
                                    <div class="row no-gutters align-items-center">
                                        <div class="col mr-2">
                                            <div class="text-xs font-weight-bold text-warning text-uppercase mb-1">Total Usage</div>
                                            <div class="h5 mb-0 font-weight-bold text-gray-800" id="productVoucherUsageCount">0</div>
                                        </div>
                                        <div class="col-auto">
                                            <i class="fas fa-chart-bar fa-2x text-gray-300"></i>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="card shadow">
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table table-bordered">
                                    <thead>
                                        <tr>
                                            <th>Code</th>
                                            <th>Name</th>
                                            <th>Discount</th>
                                            <th>Target</th>
                                            <th>Conditions</th>
                                            <th>Usage</th>
                                            <th>Status</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody id="productVouchersTableBody">
                                        <tr>
                                            <td colspan="8" class="text-center">
                                                <div class="spinner-border text-primary" role="status">
                                                    <span class="visually-hidden">Loading...</span>
                                                </div>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Reviews Section -->
                <div id="reviews" class="content-section" style="display: none;">
                    <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                        <h1 class="h2"><i class="fas fa-star me-2"></i>Ulasan Management</h1>
                    </div>

                    <div class="card shadow">
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table table-bordered">
                                    <thead>
                                        <tr>
                                            <th>Customer</th>
                                            <th>Product</th>
                                            <th>Rating</th>
                                            <th>Review</th>
                                            <th>Date</th>
                                            <th>Status</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody id="reviewsTableBody">
                                        <tr>
                                            <td colspan="7" class="text-center">
                                                <div class="spinner-border text-primary" role="status">
                                                    <span class="visually-hidden">Loading...</span>
                                                </div>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Review Detail Modal -->
                <div class="modal fade" id="reviewDetailModal" tabindex="-1" aria-hidden="true">
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title">Review Detail</h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                            </div>
                            <div class="modal-body">
                                <div class="mb-2"><strong>Customer:</strong> <span data-field="customer"></span></div>
                                <div class="mb-2"><strong>Product:</strong> <span data-field="product"></span></div>
                                <div class="mb-2"><strong>Rating:</strong> <span data-field="rating"></span></div>
                                <div class="mb-2"><strong>Review:</strong> <span data-field="review"></span></div>
                                <div class="mb-2"><strong>Date:</strong> <span data-field="date"></span></div>
                                <div class="mb-2"><strong>Status:</strong> <span data-field="status"></span></div>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                            </div>
                        </div>
                    </div>
                </div>

                

                <!-- Categories Section -->
                <div id="categories" class="content-section" style="display: none;">
                    <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                        <h1 class="h2"><i class="fas fa-tags me-2"></i>Categories Management</h1>
                        <button class="btn btn-primary" onclick="showCategoryModal()">
                            <i class="fas fa-plus me-2"></i>Add Category
                        </button>
                    </div>

                    <!-- Categories Stats Cards -->
                    <div class="row mb-4">
                        <div class="col-md-3">
                            <div class="card border-left-primary shadow h-100 py-2">
                                <div class="card-body">
                                    <div class="row no-gutters align-items-center">
                                        <div class="col mr-2">
                                            <div class="text-xs font-weight-bold text-primary text-uppercase mb-1">Total Categories</div>
                                            <div class="h5 mb-0 font-weight-bold text-gray-800" id="totalCategoriesCount">0</div>
                                        </div>
                                        <div class="col-auto">
                                            <i class="fas fa-tags fa-2x text-gray-300"></i>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="card border-left-success shadow h-100 py-2">
                                <div class="card-body">
                                    <div class="row no-gutters align-items-center">
                                        <div class="col mr-2">
                                            <div class="text-xs font-weight-bold text-success text-uppercase mb-1">Active Categories</div>
                                            <div class="h5 mb-0 font-weight-bold text-gray-800" id="activeCategoriesCount">0</div>
                                        </div>
                                        <div class="col-auto">
                                            <i class="fas fa-check-circle fa-2x text-gray-300"></i>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="card border-left-info shadow h-100 py-2">
                                <div class="card-body">
                                    <div class="row no-gutters align-items-center">
                                        <div class="col mr-2">
                                            <div class="text-xs font-weight-bold text-info text-uppercase mb-1">Main Categories</div>
                                            <div class="h5 mb-0 font-weight-bold text-gray-800" id="mainCategoriesCount">0</div>
                                        </div>
                                        <div class="col-auto">
                                            <i class="fas fa-layer-group fa-2x text-gray-300"></i>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="card border-left-warning shadow h-100 py-2">
                                <div class="card-body">
                                    <div class="row no-gutters align-items-center">
                                        <div class="col mr-2">
                                            <div class="text-xs font-weight-bold text-warning text-uppercase mb-1">Subcategories</div>
                                            <div class="h5 mb-0 font-weight-bold text-gray-800" id="subcategoriesCount">0</div>
                                        </div>
                                        <div class="col-auto">
                                            <i class="fas fa-sitemap fa-2x text-gray-300"></i>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="card shadow">
                        <div class="card-body">
                            <div class="d-flex justify-content-between align-items-center mb-3">
                                <h5 class="mb-0">Categories List</h5>
                                <div class="btn-group">
                                    <button type="button" class="btn btn-outline-secondary btn-sm" onclick="loadCategories()">
                                        <i class="fas fa-sync-alt me-1"></i>Refresh
                                    </button>
                                </div>
                            </div>
                            
                            <div class="table-responsive">
                                <table class="table table-bordered">
                                    <thead>
                                        <tr>
                                            <th>Name</th>
                                            <th>Slug</th>
                                            <th>Parent Category</th>
                                            <th>Products Count</th>
                                            <th>Sort Order</th>
                                            <th>Status</th>
                                            <th>Meta Title</th>
                                            <th>Meta Description</th>
                                            <th>Created</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody id="categoriesTableBody">
                                        <tr>
                                            <td colspan="10" class="text-center">
                                                <div class="spinner-border text-primary" role="status">
                                                    <span class="visually-hidden">Loading...</span>
                                                </div>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Analytics Section -->
                <div id="analytics" class="content-section" style="display: none;">
                    <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                        <h1 class="h2"><i class="fas fa-chart-bar me-2"></i>Dashboard Analytics & Laporan</h1>
                        <div class="btn-toolbar mb-2 mb-md-0">
                            <div class="btn-group me-2">
                                <button class="btn btn-outline-secondary btn-sm" onclick="exportAnalytics('pdf')">
                                    <i class="fas fa-file-pdf me-1"></i>Export PDF
                                </button>
                                <button class="btn btn-outline-secondary btn-sm" onclick="exportAnalytics('excel')">
                                    <i class="fas fa-file-excel me-1"></i>Export Excel
                                </button>
                            </div>
                            <button class="btn btn-primary" onclick="refreshAnalytics()">
                                <i class="fas fa-sync-alt me-2"></i>Refresh Data
                            </button>
                        </div>
                    </div>

                    <!-- Filter Controls -->
                    <div class="row mb-4">
                        <div class="col-md-12">
                            <div class="card shadow-sm">
                                <div class="card-body">
                                    <div class="row align-items-center">
                                        <div class="col-md-3">
                                            <label class="form-label fw-bold">Periode Waktu</label>
                                            <select class="form-select" id="analyticsTimePeriod" onchange="updateAnalyticsPeriod(this.value)">
                                                <option value="7days">7 Hari Terakhir</option>
                                                <option value="30days">30 Hari Terakhir</option>
                                                <option value="90days">3 Bulan Terakhir</option>
                                                <option value="365days">1 Tahun Terakhir</option>
                                                <option value="custom">Custom Range</option>
                                            </select>
                                        </div>
                                        <div class="col-md-3">
                                            <label class="form-label fw-bold">Kategori Produk</label>
                                            <select class="form-select" id="analyticsCategoryFilter" onchange="updateCategoryFilter(this.value)">
                                                <option value="all">Semua Kategori</option>
                                                <option value="laptops">Laptop</option>
                                                <option value="handphone">Handphone</option>
                                                <option value="tablet">Tablet</option>
                                                <option value="accessories">Accessories</option>
                                            </select>
                                        </div>
                                        <div class="col-md-3">
                                            <label class="form-label fw-bold">Jenis Grafik</label>
                                            <select class="form-select" id="analyticsChartType" onchange="updateChartType(this.value)">
                                                <option value="all">Tampilkan Semua</option>
                                                <option value="sales">Grafik Penjualan</option>
                                                <option value="products">Grafik Produk</option>
                                                <option value="customers">Grafik Pelanggan</option>
                                                <option value="revenue">Grafik Revenue</option>
                                            </select>
                                        </div>
                                        <div class="col-md-3">
                                            <label class="form-label fw-bold">Aksi</label>
                                            <div class="d-flex gap-2">
                                                <button class="btn btn-success btn-sm" onclick="applyFilters()">
                                                    <i class="fas fa-filter me-1"></i>Apply
                                                </button>
                                                <button class="btn btn-outline-secondary btn-sm" onclick="resetFilters()">
                                                    <i class="fas fa-undo me-1"></i>Reset
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Analytics Summary Cards -->
                    <div class="row mb-4">
                        <div class="col-md-3">
                            <div class="card shadow analytics-card border-start border-primary border-4">
                                <div class="card-body">
                                    <div class="d-flex align-items-center">
                                        <div class="flex-shrink-0">
                                            <i class="fas fa-chart-line fa-2x text-primary"></i>
                                        </div>
                                        <div class="flex-grow-1 ms-3">
                                            <h6 class="card-title mb-1 text-muted">Total Revenue</h6>
                                            <h4 class="text-primary mb-0" id="totalSalesAmount">Rp 0</h4>
                                            <small class="text-success" id="revenueGrowth"><i class="fas fa-arrow-up"></i> +15.3%</small>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="card shadow analytics-card border-start border-success border-4">
                                <div class="card-body">
                                    <div class="d-flex align-items-center">
                                        <div class="flex-shrink-0">
                                            <i class="fas fa-shopping-cart fa-2x text-success"></i>
                                        </div>
                                        <div class="flex-grow-1 ms-3">
                                            <h6 class="card-title mb-1 text-muted">Total Orders</h6>
                                            <h4 class="text-success mb-0" id="totalOrders">0</h4>
                                            <small class="text-success" id="orderGrowth"><i class="fas fa-arrow-up"></i> +8.2%</small>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="card shadow analytics-card border-start border-info border-4">
                                <div class="card-body">
                                    <div class="d-flex align-items-center">
                                        <div class="flex-shrink-0">
                                            <i class="fas fa-users fa-2x text-info"></i>
                                        </div>
                                        <div class="flex-grow-1 ms-3">
                                            <h6 class="card-title mb-1 text-muted">Active Customers</h6>
                                            <h4 class="text-info mb-0" id="totalCustomers">0</h4>
                                            <small class="text-success" id="customerGrowth"><i class="fas fa-arrow-up"></i> +12.5%</small>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="card shadow analytics-card border-start border-warning border-4">
                                <div class="card-body">
                                    <div class="d-flex align-items-center">
                                        <div class="flex-shrink-0">
                                            <i class="fas fa-box fa-2x text-warning"></i>
                                        </div>
                                        <div class="flex-grow-1 ms-3">
                                            <h6 class="card-title mb-1 text-muted">Products Sold</h6>
                                            <h4 class="text-warning mb-0" id="totalProductsSold">0</h4>
                                            <small class="text-success" id="productGrowth"><i class="fas fa-arrow-up"></i> +5.7%</small>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Additional KPI Cards -->
                    <div class="row mb-4">
                        <div class="col-md-2">
                            <div class="card shadow-sm text-center">
                                <div class="card-body py-3">
                                    <i class="fas fa-eye text-secondary mb-2"></i>
                                    <h6 class="mb-1">Page Views</h6>
                                    <h5 class="text-secondary mb-0" id="pageViews">0</h5>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-2">
                            <div class="card shadow-sm text-center">
                                <div class="card-body py-3">
                                    <i class="fas fa-mouse-pointer text-secondary mb-2"></i>
                                    <h6 class="mb-1">Conversion</h6>
                                    <h5 class="text-secondary mb-0" id="conversionRate">0%</h5>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-2">
                            <div class="card shadow-sm text-center">
                                <div class="card-body py-3">
                                    <i class="fas fa-clock text-secondary mb-2"></i>
                                    <h6 class="mb-1">Avg. Time</h6>
                                    <h5 class="text-secondary mb-0" id="avgTime">0m</h5>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-2">
                            <div class="card shadow-sm text-center">
                                <div class="card-body py-3">
                                    <i class="fas fa-undo text-secondary mb-2"></i>
                                    <h6 class="mb-1">Bounce Rate</h6>
                                    <h5 class="text-secondary mb-0" id="bounceRate">0%</h5>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-2">
                            <div class="card shadow-sm text-center">
                                <div class="card-body py-3">
                                    <i class="fas fa-star text-secondary mb-2"></i>
                                    <h6 class="mb-1">Avg. Rating</h6>
                                    <h5 class="text-secondary mb-0" id="avgRating">0.0</h5>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-2">
                            <div class="card shadow-sm text-center">
                                <div class="card-body py-3">
                                    <i class="fas fa-shipping-fast text-secondary mb-2"></i>
                                    <h6 class="mb-1">Delivery Time</h6>
                                    <h5 class="text-secondary mb-0" id="avgDelivery">0d</h5>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Main Charts Grid -->
                    <div class="row mb-4">
                        <!-- Sales Trend Chart -->
                        <div class="col-md-8">
                            <div class="card shadow">
                                <div class="card-header bg-primary text-white">
                                    <div class="d-flex justify-content-between align-items-center">
                                        <h5 class="mb-0"><i class="fas fa-chart-line me-2"></i>Sales & Revenue Trend</h5>
                                        <div class="btn-group btn-group-sm">
                                            <button class="btn btn-outline-light btn-sm" onclick="updateChartPeriod('7days')">7D</button>
                                            <button class="btn btn-outline-light btn-sm" onclick="updateChartPeriod('30days')">30D</button>
                                            <button class="btn btn-outline-light btn-sm" onclick="updateChartPeriod('90days')">3M</button>
                                            <button class="btn btn-outline-light btn-sm" onclick="updateChartPeriod('365days')">1Y</button>
                                        </div>
                                    </div>
                                </div>
                                <div class="card-body">
                                    <canvas id="revenueChart" width="400" height="200"></canvas>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Category Distribution -->
                        <div class="col-md-4">
                            <div class="card shadow">
                                <div class="card-header bg-success text-white">
                                    <h5 class="mb-0"><i class="fas fa-chart-pie me-2"></i>Category Sales</h5>
                                </div>
                                <div class="card-body">
                                    <canvas id="categoryChart" width="300" height="200"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Secondary Charts Row -->
                    <div class="row mb-4">
                        <!-- Top Products Bar Chart -->
                        <div class="col-md-6">
                            <div class="card shadow">
                                <div class="card-header bg-info text-white">
                                    <div class="d-flex justify-content-between align-items-center">
                                        <h5 class="mb-0"><i class="fas fa-chart-bar me-2"></i>Top Products Performance</h5>
                                        <div class="btn-group">
                                            <button id="topProductsLimitBtn" type="button" class="btn btn-light btn-sm dropdown-toggle" data-bs-toggle="dropdown" aria-expanded="false">
                                                Top 10
                                            </button>
                                            <ul class="dropdown-menu dropdown-menu-end">
                                                <li><button class="dropdown-item" type="button" onclick="updateProductLimit(10)">Top 10</button></li>
                                                <li><button class="dropdown-item" type="button" onclick="updateProductLimit(15)">Top 15</button></li>
                                                <li><button class="dropdown-item" type="button" onclick="updateProductLimit(20)">Top 20</button></li>
                                            </ul>
                                        </div>
                                    </div>
                                </div>
                                <div class="card-body">
                                    <canvas id="productSalesChart" width="400" height="300"></canvas>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Category Revenue Comparison -->
                        <div class="col-md-6">
                            <div class="card shadow">
                                <div class="card-header bg-warning text-dark">
                                    <h5 class="mb-0"><i class="fas fa-chart-area me-2"></i>Revenue by Category</h5>
                                </div>
                                <div class="card-body">
                                    <canvas id="categoryRevenueChart" width="400" height="300"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Advanced Analytics Row -->
                    <div class="row mb-4">
                        <!-- Customer Analytics -->
                        <div class="col-md-8">
                            <div class="card shadow">
                                <div class="card-header bg-secondary text-white">
                                    <h5 class="mb-0"><i class="fas fa-users-cog me-2"></i>Customer & Traffic Analytics</h5>
                                </div>
                                <div class="card-body">
                                    <div class="row">
                                        <div class="col-md-8">
                                            <canvas id="visitorTrendChart" width="600" height="300"></canvas>
                                        </div>
                                        <div class="col-md-4">
                                            <h6 class="fw-bold mb-3">Traffic Statistics</h6>
                                            <div class="visitor-stats">
                                                <div class="d-flex justify-content-between mb-2 p-2 bg-light rounded">
                                                    <span><i class="fas fa-calendar-day text-primary me-2"></i>Today:</span>
                                                    <strong id="visitorToday">0</strong>
                                                </div>
                                                <div class="d-flex justify-content-between mb-2 p-2 bg-light rounded">
                                                    <span><i class="fas fa-calendar-week text-success me-2"></i>This Week:</span>
                                                    <strong id="visitorWeek">0</strong>
                                                </div>
                                                <div class="d-flex justify-content-between mb-2 p-2 bg-light rounded">
                                                    <span><i class="fas fa-calendar-alt text-info me-2"></i>This Month:</span>
                                                    <strong id="visitorMonth">0</strong>
                                                </div>
                                                <div class="d-flex justify-content-between mb-2 p-2 bg-light rounded">
                                                    <span><i class="fas fa-chart-line text-warning me-2"></i>Daily Avg:</span>
                                                    <strong id="visitorAverage">0</strong>
                                                </div>
                                                <hr>
                                                <div class="d-flex justify-content-between p-2 bg-primary text-white rounded">
                                                    <span><i class="fas fa-clock me-2"></i>Peak Hour:</span>
                                                    <strong id="peakHour">-</strong>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Performance Metrics -->
                        <div class="col-md-4">
                            <div class="card shadow">
                                <div class="card-header bg-dark text-white">
                                    <h5 class="mb-0"><i class="fas fa-tachometer-alt me-2"></i>Performance Metrics</h5>
                                </div>
                                <div class="card-body">
                                    <canvas id="performanceChart" width="300" height="300"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Product Sales Performance Charts -->
                    <div class="row mb-4">
                        <!-- Top Selling Products Chart -->
                        <div class="col-md-8">
                            <div class="card shadow">
                                <div class="card-header bg-success text-white">
                                    <div class="d-flex justify-content-between align-items-center">
                                        <h5 class="mb-0"><i class="fas fa-chart-bar me-2"></i>Grafik Penjualan Produk Terlaris</h5>
                                        <div class="btn-group btn-group-sm">
                                            <button class="btn btn-outline-light btn-sm" onclick="updateTopProductsPeriod('week')">Minggu</button>
                                            <button class="btn btn-outline-light btn-sm" onclick="updateTopProductsPeriod('month')">Bulan</button>
                                            <button class="btn btn-outline-light btn-sm" onclick="updateTopProductsPeriod('quarter')">Kuartal</button>
                                        </div>
                                    </div>
                                </div>
                                <div class="card-body">
                                    <canvas id="topProductsSalesChart" width="600" height="300"></canvas>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Top Products Summary -->
                        <div class="col-md-4">
                            <div class="card shadow">
                                <div class="card-header bg-info text-white">
                                    <h5 class="mb-0"><i class="fas fa-trophy me-2"></i>Top 5 Produk</h5>
                                </div>
                                <div class="card-body">
                                    <div id="topProductsSummary">
                                        <!-- Top products summary will be loaded here -->
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Monthly Profit Loss Analysis -->
                    <div class="row mb-4">
                        <!-- Monthly Profit/Loss Chart -->
                        <div class="col-md-8">
                            <div class="card shadow">
                                <div class="card-header bg-warning text-dark">
                                    <div class="d-flex justify-content-between align-items-center">
                                        <h5 class="mb-0"><i class="fas fa-chart-line me-2"></i>Analisis Keuntungan & Kerugian Bulanan</h5>
                                        <div class="btn-group btn-group-sm">
                                            <button class="btn btn-outline-dark btn-sm" onclick="updateProfitLossPeriod('6months')">6 Bulan</button>
                                            <button class="btn btn-outline-dark btn-sm" onclick="updateProfitLossPeriod('12months')">1 Tahun</button>
                                            <button class="btn btn-outline-dark btn-sm" onclick="updateProfitLossPeriod('24months')">2 Tahun</button>
                                        </div>
                                    </div>
                                </div>
                                <div class="card-body">
                                    <canvas id="monthlyProfitLossChart" width="600" height="350"></canvas>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Profit Summary Cards -->
                        <div class="col-md-4">
                            <div class="card shadow">
                                <div class="card-header bg-dark text-white">
                                    <h5 class="mb-0"><i class="fas fa-calculator me-2"></i>Ringkasan Keuangan</h5>
                                </div>
                                <div class="card-body">
                                    <div class="mb-3">
                                        <div class="d-flex justify-content-between align-items-center p-3 bg-success text-white rounded">
                                            <div>
                                                <i class="fas fa-arrow-up fa-lg"></i>
                                                <span class="ms-2">Total Keuntungan</span>
                                            </div>
                                            <strong id="totalProfit">Rp 0</strong>
                                        </div>
                                    </div>
                                    <div class="mb-3">
                                        <div class="d-flex justify-content-between align-items-center p-3 bg-danger text-white rounded">
                                            <div>
                                                <i class="fas fa-arrow-down fa-lg"></i>
                                                <span class="ms-2">Total Kerugian</span>
                                            </div>
                                            <strong id="totalLoss">Rp 0</strong>
                                        </div>
                                    </div>
                                    <div class="mb-3">
                                        <div class="d-flex justify-content-between align-items-center p-3 bg-primary text-white rounded">
                                            <div>
                                                <i class="fas fa-balance-scale fa-lg"></i>
                                                <span class="ms-2">Net Profit</span>
                                            </div>
                                            <strong id="netProfit">Rp 0</strong>
                                        </div>
                                    </div>
                                    <div class="mb-3">
                                        <div class="d-flex justify-content-between align-items-center p-3 bg-info text-white rounded">
                                            <div>
                                                <i class="fas fa-percentage fa-lg"></i>
                                                <span class="ms-2">Profit Margin</span>
                                            </div>
                                            <strong id="profitMargin">0%</strong>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Product Performance Analysis -->
                    <div class="row mb-4">
                        <!-- Product Sales Comparison -->
                        <div class="col-md-6">
                            <div class="card shadow">
                                <div class="card-header bg-secondary text-white">
                                    <h5 class="mb-0"><i class="fas fa-chart-pie me-2"></i>Perbandingan Penjualan Produk</h5>
                                </div>
                                <div class="card-body">
                                    <canvas id="productComparisonChart" width="400" height="300"></canvas>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Monthly Sales Trend by Product -->
                        <div class="col-md-6">
                            <div class="card shadow">
                                <div class="card-header bg-purple text-white" style="background-color: #6f42c1 !important;">
                                    <h5 class="mb-0"><i class="fas fa-chart-area me-2"></i>Tren Penjualan Bulanan</h5>
                                </div>
                                <div class="card-body">
                                    <canvas id="monthlySalesTrendChart" width="400" height="300"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Data Tables Row -->
                    <div class="row mb-4">
                        <!-- Top Products Table -->
                        <div class="col-md-6">
                            <div class="card shadow">
                                <div class="card-header">
                                    <h5 class="mb-0"><i class="fas fa-trophy me-2"></i>Top Selling Products</h5>
                                </div>
                                <div class="card-body">
                                    <div class="table-responsive">
                                        <table class="table table-hover" id="topProductsTable">
                                            <thead class="table-dark">
                                                <tr>
                                                    <th>Rank</th>
                                                    <th>Product</th>
                                                    <th>Sales</th>
                                                    <th>Revenue</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <!-- Data will be loaded here -->
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Recent Orders -->
                        <div class="col-md-6">
                            <div class="card shadow">
                                <div class="card-header">
                                    <h5 class="mb-0"><i class="fas fa-shopping-bag me-2"></i>Recent High-Value Orders</h5>
                                </div>
                                <div class="card-body">
                                    <div class="table-responsive">
                                        <table class="table table-hover" id="recentOrdersTable">
                                            <thead class="table-dark">
                                                <tr>
                                                    <th>Order ID</th>
                                                    <th>Customer</th>
                                                    <th>Amount</th>
                                                    <th>Status</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <!-- Data will be loaded here -->
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Monthly Analytics Section -->
                    <div class="row mb-4">
                        <!-- Monthly Best Selling Products Chart -->
                        <div class="col-md-6">
                            <div class="card shadow">
                                <div class="card-header bg-primary text-white">
                                    <h5 class="mb-0"><i class="fas fa-trophy me-2"></i>Produk Terlaris Bulanan</h5>
                                </div>
                                <div class="card-body">
                                    <div class="mb-3">
                                        <div class="row">
                                            <div class="col-md-6">
                                                <label class="form-label">Bulan</label>
                                                <select class="form-select form-select-sm" id="bestsellerMonth" onchange="loadMonthlyBestsellers()">
                                                    <option value="1">Januari</option>
                                                    <option value="2">Februari</option>
                                                    <option value="3">Maret</option>
                                                    <option value="4">April</option>
                                                    <option value="5">Mei</option>
                                                    <option value="6">Juni</option>
                                                    <option value="7">Juli</option>
                                                    <option value="8">Agustus</option>
                                                    <option value="9">September</option>
                                                    <option value="10">Oktober</option>
                                                    <option value="11">November</option>
                                                    <option value="12">Desember</option>
                                                </select>
                                            </div>
                                            <div class="col-md-6">
                                                <label class="form-label">Tahun</label>
                                                <select class="form-select form-select-sm" id="bestsellerYear" onchange="loadMonthlyBestsellers()">
                                                    <option value="2024">2024</option>
                                                    <option value="2023">2023</option>
                                                </select>
                                            </div>
                                        </div>
                                    </div>
                                    <canvas id="monthlyBestsellersChart" width="400" height="300"></canvas>
                                </div>
                            </div>
                        </div>

                        <!-- Monthly Profit & Loss Chart -->
                        <div class="col-md-6">
                            <div class="card shadow">
                                <div class="card-header bg-success text-white">
                                    <h5 class="mb-0"><i class="fas fa-chart-line me-2"></i>Keuntungan & Kerugian Bulanan</h5>
                                </div>
                                <div class="card-body">
                                    <div class="mb-3">
                                        <div class="row">
                                            <div class="col-md-6">
                                                <label class="form-label">Tahun</label>
                                                <select class="form-select form-select-sm" id="profitLossYear" onchange="loadMonthlyProfitLoss()">
                                                    <option value="2024">2024</option>
                                                    <option value="2023">2023</option>
                                                </select>
                                            </div>
                                            <div class="col-md-6">
                                                <div class="mt-4">
                                                    <small class="text-muted">
                                                        <i class="fas fa-info-circle me-1"></i>Data dalam Rupiah (Juta)
                                                    </small>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <canvas id="monthlyProfitLossChart" width="400" height="300"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Monthly Summary Cards -->
                    <div class="row mb-4">
                        <div class="col-md-3">
                            <div class="card shadow border-start border-success border-4">
                                <div class="card-body">
                                    <div class="d-flex align-items-center">
                                        <div class="flex-shrink-0">
                                            <i class="fas fa-chart-line fa-2x text-success"></i>
                                        </div>
                                        <div class="flex-grow-1 ms-3">
                                            <div class="small fw-bold text-success text-uppercase mb-1">Total Keuntungan</div>
                                            <div class="h5 mb-0" id="totalYearlyProfit">Rp 0</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="card shadow border-start border-primary border-4">
                                <div class="card-body">
                                    <div class="d-flex align-items-center">
                                        <div class="flex-shrink-0">
                                            <i class="fas fa-percentage fa-2x text-primary"></i>
                                        </div>
                                        <div class="flex-grow-1 ms-3">
                                            <div class="small fw-bold text-primary text-uppercase mb-1">Margin Keuntungan</div>
                                            <div class="h5 mb-0" id="averageProfitMargin">0%</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="card shadow border-start border-info border-4">
                                <div class="card-body">
                                    <div class="d-flex align-items-center">
                                        <div class="flex-shrink-0">
                                            <i class="fas fa-calendar-check fa-2x text-info"></i>
                                        </div>
                                        <div class="flex-grow-1 ms-3">
                                            <div class="small fw-bold text-info text-uppercase mb-1">Bulan Terbaik</div>
                                            <div class="h6 mb-0" id="bestProfitMonth">-</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="card shadow border-start border-warning border-4">
                                <div class="card-body">
                                    <div class="d-flex align-items-center">
                                        <div class="flex-shrink-0">
                                            <i class="fas fa-star fa-2x text-warning"></i>
                                        </div>
                                        <div class="flex-grow-1 ms-3">
                                            <div class="small fw-bold text-warning text-uppercase mb-1">Produk Terlaris</div>
                                            <div class="h6 mb-0" id="topSellingProduct">-</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>


                    <!-- Product Analytics -->
                    <div class="row mb-4">
                        <div class="col-md-6">
                            <div class="card shadow">
                                <div class="card-header">
                                    <h5 class="mb-0">Statistik Penjualan per Produk</h5>
                                </div>
                                <div class="card-body">
                                    <div class="table-responsive">
                                        <table class="table table-sm">
                                            <thead>
                                                <tr>
                                                    <th>Produk</th>
                                                    <th>Terjual</th>
                                                    <th>Pendapatan</th>
                                                    <th>Persentase</th>
                                                </tr>
                                            </thead>
                                            <tbody id="productStatsTable">
                                                <!-- Product statistics will be populated here -->
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="card shadow">
                                <div class="card-header">
                                    <h5 class="mb-0">Top 10 Produk Paling Laris</h5>
                                </div>
                                <div class="card-body">
                                    <div id="topProductsList">
                                        <!-- Top products will be populated here -->
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>


                <!-- Settings Section -->
                <div id="settings" class="content-section" style="display: none;">
                    <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                        <h1 class="h2"><i class="fas fa-cog me-2"></i>Pengaturan Toko</h1>
                        <div class="btn-toolbar mb-2 mb-md-0">
                            <button type="button" class="btn btn-success" onclick="saveAllSettings()">
                                <i class="fas fa-save me-2"></i>Simpan Semua Pengaturan
                            </button>
                        </div>
                    </div>

                    <!-- Settings Navigation Tabs -->
                    <ul class="nav nav-tabs mb-4" id="settingsTabs" role="tablist">
                        <li class="nav-item" role="presentation">
                            <button class="nav-link active" id="profile-tab" data-bs-toggle="tab" data-bs-target="#profile-settings" type="button" role="tab">
                                <i class="fas fa-store me-2"></i>Profil Toko
                            </button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="hours-tab" data-bs-toggle="tab" data-bs-target="#hours-settings" type="button" role="tab">
                                <i class="fas fa-clock me-2"></i>Jam Operasional
                            </button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="address-tab" data-bs-toggle="tab" data-bs-target="#address-settings" type="button" role="tab">
                                <i class="fas fa-map-marker-alt me-2"></i>Alamat & Pengiriman
                            </button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="payment-tab" data-bs-toggle="tab" data-bs-target="#payment-settings" type="button" role="tab">
                                <i class="fas fa-credit-card me-2"></i>Metode Pembayaran
                            </button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="shipping-tab" data-bs-toggle="tab" data-bs-target="#shipping-settings" type="button" role="tab">
                                <i class="fas fa-shipping-fast me-2"></i>Metode Pengiriman
                            </button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="social-tab" data-bs-toggle="tab" data-bs-target="#social-settings" type="button" role="tab">
                                <i class="fas fa-share-alt me-2"></i>Media Sosial
                            </button>
                        </li>
                    </ul>

                    <!-- Settings Tab Content -->
                    <div class="tab-content" id="settingsTabContent">
                        <!-- Store Profile Settings -->
                        <div class="tab-pane fade show active" id="profile-settings" role="tabpanel">
                            <div class="card shadow">
                                <div class="card-header">
                                    <h5 class="mb-0"><i class="fas fa-store me-2"></i>Profil Toko</h5>
                                </div>
                                <div class="card-body">
                                    <form id="profileForm">
                                        <div class="row">
                                            <div class="col-md-6">
                                                <div class="mb-3">
                                                    <label for="storeName" class="form-label">Nama Toko *</label>
                                                    <input type="text" class="form-control" id="storeName" required>
                                                </div>
                                                <div class="mb-3">
                                                    <label for="storeTagline" class="form-label">Tagline</label>
                                                    <input type="text" class="form-control" id="storeTagline" placeholder="Slogan atau motto toko">
                                                </div>
                                                <div class="mb-3">
                                                    <label for="storePhone" class="form-label">Nomor Telepon</label>
                                                    <input type="tel" class="form-control" id="storePhone">
                                                </div>
                                                <div class="mb-3">
                                                    <label for="storeEmail" class="form-label">Email</label>
                                                    <input type="email" class="form-control" id="storeEmail">
                                                </div>
                                                <div class="mb-3">
                                                    <label for="storeWebsite" class="form-label">Website</label>
                                                    <input type="url" class="form-control" id="storeWebsite">
                                                </div>
                                            </div>
                                            <div class="col-md-6">
                                                <div class="mb-3">
                                                    <label for="storeDescription" class="form-label">Deskripsi Toko</label>
                                                    <textarea class="form-control" id="storeDescription" rows="4" placeholder="Ceritakan tentang toko Anda..."></textarea>
                                                </div>
                                                <div class="mb-3">
                                                    <label class="form-label">Logo Toko</label>
                                                    <div class="d-flex align-items-center">
                                                        <img id="logoPreview" src="" alt="Logo" class="me-3 rounded" style="width: 80px; height: 80px; object-fit: cover; display: none;">
                                                        <div>
                                                            <input type="file" class="form-control mb-2" id="logoUpload" accept="image/*">
                                                            <small class="text-muted">Ukuran optimal: 200x200px, Max: 2MB</small>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="mb-3">
                                                    <label class="form-label">Banner Toko</label>
                                                    <div>
                                                        <img id="bannerPreview" src="" alt="Banner" class="mb-2 rounded" style="width: 100%; height: 120px; object-fit: cover; display: none;">
                                                        <input type="file" class="form-control mb-2" id="bannerUpload" accept="image/*">
                                                        <small class="text-muted">Ukuran optimal: 1200x400px, Max: 5MB</small>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="text-end">
                                            <button type="button" class="btn btn-primary" onclick="saveProfileSettings()">
                                                <i class="fas fa-save me-2"></i>Simpan Profil
                                            </button>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>

                        <!-- Operating Hours Settings -->
                        <div class="tab-pane fade" id="hours-settings" role="tabpanel">
                            <div class="card shadow">
                                <div class="card-header">
                                    <h5 class="mb-0"><i class="fas fa-clock me-2"></i>Jam Operasional</h5>
                                </div>
                                <div class="card-body">
                                    <form id="hoursForm">
                                        <div id="operatingHoursContainer">
                                            <!-- Operating hours will be populated here -->
                                        </div>
                                        <div class="text-end mt-3">
                                            <button type="button" class="btn btn-primary" onclick="saveOperatingHours()">
                                                <i class="fas fa-save me-2"></i>Simpan Jam Operasional
                                            </button>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>

                        <!-- Address & Shipping Settings -->
                        <div class="tab-pane fade" id="address-settings" role="tabpanel">
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="card shadow">
                                        <div class="card-header">
                                            <h5 class="mb-0"><i class="fas fa-map-marker-alt me-2"></i>Alamat Toko</h5>
                                        </div>
                                        <div class="card-body">
                                            <form id="addressForm">
                                                <div class="mb-3">
                                                    <label for="storeStreet" class="form-label">Alamat Lengkap *</label>
                                                    <textarea class="form-control" id="storeStreet" rows="2" required></textarea>
                                                </div>
                                                <div class="row">
                                                    <div class="col-md-6">
                                                        <div class="mb-3">
                                                            <label for="storeCity" class="form-label">Kota *</label>
                                                            <input type="text" class="form-control" id="storeCity" required>
                                                        </div>
                                                    </div>
                                                    <div class="col-md-6">
                                                        <div class="mb-3">
                                                            <label for="storeProvince" class="form-label">Provinsi *</label>
                                                            <input type="text" class="form-control" id="storeProvince" required>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="row">
                                                    <div class="col-md-6">
                                                        <div class="mb-3">
                                                            <label for="storePostalCode" class="form-label">Kode Pos</label>
                                                            <input type="text" class="form-control" id="storePostalCode">
                                                        </div>
                                                    </div>
                                                    <div class="col-md-6">
                                                        <div class="mb-3">
                                                            <label for="storeCountry" class="form-label">Negara</label>
                                                            <input type="text" class="form-control" id="storeCountry" value="Indonesia">
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="text-end">
                                                    <button type="button" class="btn btn-primary" onclick="saveAddressSettings()">
                                                        <i class="fas fa-save me-2"></i>Simpan Alamat
                                                    </button>
                                                </div>
                                            </form>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="card shadow">
                                        <div class="card-header d-flex justify-content-between align-items-center">
                                            <h5 class="mb-0"><i class="fas fa-truck me-2"></i>Zona Pengiriman</h5>
                                            <button type="button" class="btn btn-sm btn-outline-primary" onclick="addShippingZone()">
                                                <i class="fas fa-plus"></i> Tambah Zona
                                            </button>
                                        </div>
                                        <div class="card-body">
                                            <div id="shippingZonesContainer">
                                                <!-- Shipping zones will be populated here -->
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Payment Methods Settings -->
                        <div class="tab-pane fade" id="payment-settings" role="tabpanel">
                            <div class="card shadow">
                                <div class="card-header d-flex justify-content-between align-items-center">
                                    <h5 class="mb-0"><i class="fas fa-credit-card me-2"></i>Metode Pembayaran</h5>
                                    <button type="button" class="btn btn-sm btn-outline-primary" onclick="showPaymentMethodModal()">
                                        <i class="fas fa-plus"></i> Tambah Metode
                                    </button>
                                </div>
                                <div class="card-body">
                                    <div class="row" id="paymentMethodsContainer">
                                        <!-- Payment methods will be populated here -->
                                    </div>
                                    <div class="text-end mt-3">
                                        <button type="button" class="btn btn-primary" onclick="savePaymentMethods()">
                                            <i class="fas fa-save me-2"></i>Simpan Metode Pembayaran
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Shipping Methods Settings -->
                        <div class="tab-pane fade" id="shipping-settings" role="tabpanel">
                            <div class="card shadow">
                                <div class="card-header d-flex justify-content-between align-items-center">
                                    <h5 class="mb-0"><i class="fas fa-shipping-fast me-2"></i>Metode Pengiriman</h5>
                                    <button type="button" class="btn btn-sm btn-outline-primary" onclick="showShippingMethodModal()">
                                        <i class="fas fa-plus"></i> Tambah Metode Pengiriman
                                    </button>
                                </div>
                                <div class="card-body">
                                    <div class="row" id="shippingMethodsContainer">
                                        <!-- Shipping methods will be populated here -->
                                    </div>
                                    <div class="text-end mt-3">
                                        <button type="button" class="btn btn-primary" onclick="saveShippingMethods()">
                                            <i class="fas fa-save me-2"></i>Simpan Metode Pengiriman
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Social Media Settings -->
                        <div class="tab-pane fade" id="social-settings" role="tabpanel">
                            <div class="card shadow">
                                <div class="card-header">
                                    <h5 class="mb-0"><i class="fas fa-share-alt me-2"></i>Media Sosial</h5>
                                </div>
                                <div class="card-body">
                                    <form id="socialMediaForm">
                                        <div class="row">
                                            <div class="col-md-6">
                                                <div class="mb-3">
                                                    <label for="facebookUrl" class="form-label">
                                                        <i class="fab fa-facebook text-primary me-2"></i>Facebook
                                                    </label>
                                                    <input type="url" class="form-control" id="facebookUrl" placeholder="https://facebook.com/tokosaya">
                                                </div>
                                                <div class="mb-3">
                                                    <label for="instagramUrl" class="form-label">
                                                        <i class="fab fa-instagram text-danger me-2"></i>Instagram
                                                    </label>
                                                    <input type="url" class="form-control" id="instagramUrl" placeholder="https://instagram.com/tokosaya">
                                                </div>
                                                <div class="mb-3">
                                                    <label for="twitterUrl" class="form-label">
                                                        <i class="fab fa-twitter text-info me-2"></i>Twitter
                                                    </label>
                                                    <input type="url" class="form-control" id="twitterUrl" placeholder="https://twitter.com/tokosaya">
                                                </div>
                                            </div>
                                            <div class="col-md-6">
                                                <div class="mb-3">
                                                    <label for="youtubeUrl" class="form-label">
                                                        <i class="fab fa-youtube text-danger me-2"></i>YouTube
                                                    </label>
                                                    <input type="url" class="form-control" id="youtubeUrl" placeholder="https://youtube.com/tokosaya">
                                                </div>
                                                <div class="mb-3">
                                                    <label for="tiktokUrl" class="form-label">
                                                        <i class="fab fa-tiktok text-dark me-2"></i>TikTok
                                                    </label>
                                                    <input type="url" class="form-control" id="tiktokUrl" placeholder="https://tiktok.com/@tokosaya">
                                                </div>
                                                <div class="mb-3">
                                                    <label for="whatsappNumber" class="form-label">
                                                        <i class="fab fa-whatsapp text-success me-2"></i>WhatsApp
                                                    </label>
                                                    <input type="tel" class="form-control" id="whatsappNumber" placeholder="+6281234567890">
                                                </div>
                                            </div>
                                        </div>
                                        <div class="text-end">
                                            <button type="button" class="btn btn-primary" onclick="saveSocialMediaSettings()">
                                                <i class="fas fa-save me-2"></i>Simpan Media Sosial
                                            </button>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- Add/Edit Payment Method Modal -->
    <div class="modal fade" id="paymentMethodModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="paymentMethodModalTitle"><i class="fas fa-credit-card me-2"></i>Tambah Metode Pembayaran</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="paymentMethodForm" onsubmit="event.preventDefault(); savePaymentMethod()">
                        <input type="hidden" id="paymentMethodId">
                        <div class="mb-3">
                            <label class="form-label">Nama Metode</label>
                            <input type="text" class="form-control" id="paymentMethodName" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Deskripsi</label>
                            <input type="text" class="form-control" id="paymentMethodDescription" placeholder="Opsional">
                        </div>
                        <div class="form-check form-switch">
                            <input class="form-check-input" type="checkbox" id="paymentMethodEnabled" checked>
                            <label class="form-check-label" for="paymentMethodEnabled">Aktif</label>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary" data-bs-dismiss="modal">Batal</button>
                    <button class="btn btn-primary" id="savePaymentMethodBtn" onclick="savePaymentMethod()">
                        <span id="savePaymentMethodBtnText"><i class="fas fa-save me-2"></i>Simpan</span>
                    </button>
                </div>
            </div>
        </div>
    </div>

  <!-- Add/Edit Shipping Method Modal -->
  <div class="modal fade" id="shippingMethodModal" tabindex="-1" aria-hidden="true">
      <div class="modal-dialog">
          <div class="modal-content">
              <div class="modal-header">
                  <h5 class="modal-title" id="shippingMethodModalTitle"><i class="fas fa-shipping-fast me-2"></i>Tambah Metode Pengiriman</h5>
                  <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
              </div>
              <div class="modal-body">
                  <form id="shippingMethodForm" onsubmit="event.preventDefault(); saveShippingMethod()">
                      <input type="hidden" id="shippingMethodId">
                      <div class="mb-3">
                          <label class="form-label">Nama Metode</label>
                          <input type="text" class="form-control" id="shippingMethodName" required>
                      </div>
                      <div class="mb-3">
                          <label class="form-label">Deskripsi</label>
                          <input type="text" class="form-control" id="shippingMethodDescription" placeholder="Opsional">
                      </div>
                      <div class="mb-3">
                          <label class="form-label">Estimasi (hari)</label>
                          <input type="text" class="form-control" id="shippingMethodEstimatedDays" placeholder="mis. 3-5">
                      </div>
                      <div class="form-check form-switch">
                          <input class="form-check-input" type="checkbox" id="shippingMethodEnabled" checked>
                          <label class="form-check-label" for="shippingMethodEnabled">Aktif</label>
                      </div>
                  </form>
              </div>
              <div class="modal-footer">
                  <button class="btn btn-secondary" data-bs-dismiss="modal">Batal</button>
                  <button class="btn btn-primary" id="saveShippingMethodBtn" onclick="saveShippingMethod()">
                      <span id="saveShippingMethodBtnText"><i class="fas fa-save me-2"></i>Simpan</span>
                  </button>
              </div>
          </div>
      </div>
  </div>

  <!-- Add/Edit Product Modal -->
    <div class="modal fade" id="productModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="productModalTitle">Add New Product</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="productForm">
                        <input type="hidden" id="productId">
                        
                        <!-- Basic Information -->
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="productName" class="form-label">Product Name *</label>
                                    <input type="text" class="form-control" id="productName" required>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="productCategory" class="form-label">Category *</label>
                                    <select class="form-control" id="productCategory" required>
                                        <option value="">Select Category</option>
                                        <option value="laptops">Laptop</option>
                                        <option value="smartphones">Handphone</option>
                                        <option value="tablets">Tablet</option>
                                        <option value="accessories">Accessories</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <!-- Brand -->
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="productBrand" class="form-label">Brand</label>
                                    <input type="text" class="form-control" id="productBrand" placeholder="mis. ASUS, Apple, Dell">
                                </div>
                            </div>
                        </div>

                        <!-- Pricing -->
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="productRegularPrice" class="form-label">Regular Price (Rp) *</label>
                                    <input type="number" class="form-control" id="productRegularPrice" required>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="productPromoPrice" class="form-label">Promo Price (Rp)</label>
                                    <input type="number" class="form-control" id="productPromoPrice" placeholder="Leave empty if no promo">
                                </div>
                            </div>
                        </div>

                        <!-- Stock and Status -->
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="productStock" class="form-label">Stock *</label>
                                    <input type="number" class="form-control" id="productStock" required>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="productStatus" class="form-label">Status</label>
                                    <select class="form-control" id="productStatus">
                                        <option value="active">Active</option>
                                        <option value="inactive">Inactive</option>
                                        <option value="low_stock">Low Stock</option>
                                        <option value="out_of_stock">Out of Stock</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <!-- Images Upload -->
                        <div class="mb-3">
                            <label for="productImages" class="form-label">Product Images</label>
                            <input type="file" class="form-control" id="productImages" multiple accept="image/*">
                            <div class="form-text">You can upload up to 5 images. Supported formats: JPG, PNG, GIF, WebP (Max 5MB each)</div>
                            <div id="imagePreview" class="mt-2 d-flex flex-wrap gap-2"></div>
                        </div>

                        <!-- Description -->
                        <div class="mb-3">
                            <label for="productDescription" class="form-label">Description</label>
                            <textarea class="form-control" id="productDescription" rows="3"></textarea>
                        </div>

                        <!-- Product Variants -->
                        <div class="mb-3">
                            <label class="form-label">Product Variants</label>
                            <div class="border rounded p-3">
                                <div class="d-flex justify-content-between align-items-center mb-2">
                                    <h6 class="mb-0">Variants</h6>
                                    <button type="button" class="btn btn-sm btn-outline-primary" onclick="addVariant()">
                                        <i class="fas fa-plus"></i> Add Variant
                                    </button>
                                </div>
                                <div id="variantsContainer">
                                    <!-- Variants will be added here dynamically -->
                                </div>
                            </div>
                        </div>

                        
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" onclick="saveProduct()" id="saveProductBtn">
                        <span class="spinner-border spinner-border-sm d-none me-2" id="saveSpinner"></span>
                        Save Product
                    </button>
                </div>
            </div>
        </div>

        <!-- Product View Details Modal -->
        <div class="modal fade" id="productViewModal" tabindex="-1" aria-labelledby="productViewModalLabel" aria-hidden="true" style="z-index:2000;">
            <div class="modal-dialog modal-lg modal-dialog-scrollable">
                <div class="modal-content">
                    <div class="modal-header bg-primary text-white">
                        <h5 class="modal-title" id="productViewModalLabel">Product Details</h5>
                        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <div id="viewProductLoading" class="d-none text-center my-4">
                            <div class="spinner-border text-primary" role="status">
                              <span class="visually-hidden">Loading...</span>
                            </div>
                        </div>
                        <h5 id="viewProductTitle" class="mb-3"></h5>
                        <div class="mb-3" id="viewProductImages"></div>
                        <div class="row g-3" id="viewProductDetails">
                            <!-- Details rows rendered by JS -->
                        </div>
                        <div class="mt-3">
                            <h6 class="mb-2">Variants</h6>
                            <div id="viewProductVariants" class="d-flex flex-wrap gap-1"></div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Voucher Modal -->
    <div class="modal fade" id="voucherModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="voucherModalTitle">Add New Voucher</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="voucherForm">
                        <input type="hidden" id="voucherId">
                        
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="voucherCode" class="form-label">Voucher Code *</label>
                                    <input type="text" class="form-control" id="voucherCode" required placeholder="e.g., SAVE20">
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="voucherName" class="form-label">Voucher Name *</label>
                                    <input type="text" class="form-control" id="voucherName" required placeholder="e.g., 20% Off Sale">
                                </div>
                            </div>
                        </div>

                        <div class="mb-3">
                            <label for="voucherDescription" class="form-label">Description</label>
                            <textarea class="form-control" id="voucherDescription" rows="2" placeholder="Brief description of the voucher"></textarea>
                        </div>

                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="voucherType" class="form-label">Discount Type *</label>
                                    <select class="form-control" id="voucherType" required>
                                        <option value="">Select Type</option>
                                        <option value="percentage">Percentage (%)</option>
                                        <option value="fixed_amount">Fixed Amount (Rp)</option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="voucherValue" class="form-label">Discount Value *</label>
                                    <input type="number" class="form-control" id="voucherValue" required min="0" placeholder="e.g., 20 or 50000">
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="voucherMinPurchase" class="form-label">Minimum Purchase (Rp)</label>
                                    <input type="number" class="form-control" id="voucherMinPurchase" min="0" placeholder="0">
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="voucherMaxDiscount" class="form-label">Maximum Discount (Rp)</label>
                                    <input type="number" class="form-control" id="voucherMaxDiscount" min="0" placeholder="Leave empty for no limit">
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="voucherUsageLimit" class="form-label">Usage Limit</label>
                                    <input type="number" class="form-control" id="voucherUsageLimit" min="0" placeholder="Leave empty for unlimited">
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="voucherStatus" class="form-label">Status</label>
                                    <select class="form-control" id="voucherStatus">
                                        <option value="1">Active</option>
                                        <option value="0">Inactive</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="voucherStartDate" class="form-label">Start Date *</label>
                                    <input type="datetime-local" class="form-control" id="voucherStartDate" required>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="voucherEndDate" class="form-label">End Date</label>
                                    <input type="datetime-local" class="form-control" id="voucherEndDate">
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" onclick="saveVoucher()" id="saveVoucherBtn">
                        <span class="spinner-border spinner-border-sm d-none me-2" id="voucherSaveSpinner"></span>
                        Save Voucher
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Flash Sale Modal -->
    <div class="modal fade" id="flashSaleModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="flashSaleModalTitle">Add New Flash Sale</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="flashSaleForm">
                        <input type="hidden" id="flashSaleId">
                        
                        <div class="mb-3">
                            <label for="flashSaleName" class="form-label">Flash Sale Name *</label>
                            <input type="text" class="form-control" id="flashSaleName" required placeholder="e.g., Weekend Flash Sale">
                        </div>

                        <div class="mb-3">
                            <label for="flashSaleDescription" class="form-label">Description</label>
                            <textarea class="form-control" id="flashSaleDescription" rows="3" placeholder="Brief description of the flash sale"></textarea>
                        </div>

                        <div class="row">
                            <div class="col-md-4">
                                <div class="mb-3">
                                    <label for="flashSaleDiscount" class="form-label">Discount Percentage (%) *</label>
                                    <input type="number" class="form-control" id="flashSaleDiscount" required min="1" max="99" placeholder="e.g., 80">
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="mb-3">
                                    <label for="flashSaleTotalStock" class="form-label">Total Stock *</label>
                                    <input type="number" class="form-control" id="flashSaleTotalStock" required min="1" placeholder="e.g., 100">
                                    <div class="form-text">Limited stock for flash sale</div>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="mb-3">
                                    <label for="flashSaleMaxPerUser" class="form-label">Max Qty/User *</label>
                                    <input type="number" class="form-control" id="flashSaleMaxPerUser" required min="1" value="1" placeholder="1">
                                    <div class="form-text">Prevent hoarding</div>
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="flashSaleStartDate" class="form-label">Start Date *</label>
                                    <input type="date" class="form-control" id="flashSaleStartDate" required>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="flashSaleEndDate" class="form-label">End Date</label>
                                    <input type="date" class="form-control" id="flashSaleEndDate">
                                    <div class="form-text">Leave empty for single day sale</div>
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="flashSaleStartTime" class="form-label">Start Time *</label>
                                    <input type="time" class="form-control" id="flashSaleStartTime" required value="12:00">
                                    <div class="form-text">e.g., 12:00 for noon</div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="flashSaleEndTime" class="form-label">End Time *</label>
                                    <input type="time" class="form-control" id="flashSaleEndTime" required value="14:00">
                                    <div class="form-text">e.g., 14:00 for 2 PM</div>
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="flashSaleAutoApply" checked>
                                        <label class="form-check-label" for="flashSaleAutoApply">
                                            <strong>Auto Apply Discount</strong>
                                        </label>
                                        <div class="form-text">Automatically reduce product prices (no voucher code needed)</div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="flashSaleStatus" class="form-label">Status</label>
                                    <select class="form-control" id="flashSaleStatus">
                                        <option value="1">Active</option>
                                        <option value="0">Inactive</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" onclick="saveFlashSale()" id="saveFlashSaleBtn">
                        <span class="spinner-border spinner-border-sm d-none me-2" id="flashSaleSaveSpinner"></span>
                        Save Flash Sale
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Category Modal -->
    <div class="modal fade" id="categoryModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="categoryModalTitle">Add New Category</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="categoryForm">
                        <input type="hidden" id="categoryId">
                        
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="categoryName" class="form-label">Category Name *</label>
                                    <input type="text" class="form-control" id="categoryName" required placeholder="e.g., Electronics">
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="categorySlug" class="form-label">URL Slug</label>
                                    <input type="text" class="form-control" id="categorySlug" placeholder="auto-generated from name">
                                    <div class="form-text">Leave empty to auto-generate from name</div>
                                </div>
                            </div>
                        </div>

                        <div class="mb-3">
                            <label for="categoryDescription" class="form-label">Description</label>
                            <textarea class="form-control" id="categoryDescription" rows="3" placeholder="Brief description of the category"></textarea>
                        </div>

                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="categoryParent" class="form-label">Parent Category</label>
                                    <select class="form-control" id="categoryParent">
                                        <option value="">None (Main Category)</option>
                                        <!-- Options will be loaded dynamically -->
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="categorySortOrder" class="form-label">Sort Order</label>
                                    <input type="number" class="form-control" id="categorySortOrder" min="0" placeholder="0" value="0">
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="categoryImageFile" class="form-label">Image File</label>
                                    <input type="file" class="form-control" id="categoryImageFile" accept="image/*">
                                    <div class="form-text">Upload JPG, PNG, GIF, or WebP (max 5MB)</div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="categoryStatus" class="form-label">Status</label>
                                    <select class="form-control" id="categoryStatus">
                                        <option value="1">Active</option>
                                        <option value="0">Inactive</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <!-- SEO Fields -->
                        <div class="row">
                            <div class="col-12">
                                <h6 class="text-muted mb-3"><i class="fas fa-search me-2"></i>SEO Settings (Optional)</h6>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="categoryMetaTitle" class="form-label">Meta Title</label>
                                    <input type="text" class="form-control" id="categoryMetaTitle" maxlength="200" placeholder="SEO title for search engines">
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="categoryMetaDescription" class="form-label">Meta Description</label>
                                    <textarea class="form-control" id="categoryMetaDescription" rows="2" maxlength="300" placeholder="SEO description for search engines"></textarea>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" onclick="saveCategory()" id="saveCategoryBtn">
                        <span class="spinner-border spinner-border-sm d-none me-2" id="categorySaveSpinner"></span>
                        Save Category
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Free Shipping Modal -->
    <div class="modal fade" id="freeShippingModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="freeShippingModalTitle">Add New Gratis Ongkir</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="freeShippingForm">
                        <input type="hidden" id="freeShippingId">
                        
                        <div class="mb-3">
                            <label for="freeShippingName" class="form-label">Promotion Name *</label>
                            <input type="text" class="form-control" id="freeShippingName" required placeholder="e.g., Gratis Ongkir Weekend">
                        </div>

                        <div class="mb-3">
                            <label for="freeShippingDescription" class="form-label">Description</label>
                            <textarea class="form-control" id="freeShippingDescription" rows="3" placeholder="Brief description of the free shipping promotion"></textarea>
                        </div>

                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="freeShippingMinAmount" class="form-label">Minimum Purchase (Rp) *</label>
                                    <input type="number" class="form-control" id="freeShippingMinAmount" required min="0" placeholder="e.g., 50000">
                                    <div class="form-text">Minimum order value to qualify</div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="freeShippingMaxDiscount" class="form-label">Max Discount (Rp) *</label>
                                    <input type="number" class="form-control" id="freeShippingMaxDiscount" required min="0" placeholder="e.g., 20000">
                                    <div class="form-text">Maximum shipping discount amount</div>
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="freeShippingCoverage" class="form-label">Coverage Area</label>
                                    <select class="form-control" id="freeShippingCoverage">
                                        <option value="all">All Areas</option>
                                        <option value="jabodetabek">Jabodetabek</option>
                                        <option value="java">Java Island</option>
                                        <option value="indonesia">Indonesia</option>
                                        <option value="custom">Custom Areas</option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="freeShippingUsageLimit" class="form-label">Usage Limit</label>
                                    <input type="number" class="form-control" id="freeShippingUsageLimit" min="0" placeholder="Leave empty for unlimited">
                                    <div class="form-text">Max number of uses</div>
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="freeShippingStartDate" class="form-label">Start Date *</label>
                                    <input type="date" class="form-control" id="freeShippingStartDate" required>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="freeShippingEndDate" class="form-label">End Date</label>
                                    <input type="date" class="form-control" id="freeShippingEndDate">
                                    <div class="form-text">Leave empty for no expiry</div>
                                </div>
                            </div>
                        </div>

                        <div class="mb-3">
                            <label for="freeShippingStatus" class="form-label">Status</label>
                            <select class="form-control" id="freeShippingStatus">
                                <option value="1">Active</option>
                                <option value="0">Inactive</option>
                            </select>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" onclick="saveFreeShipping()" id="saveFreeShippingBtn">
                        <span class="spinner-border spinner-border-sm d-none me-2" id="freeShippingSaveSpinner"></span>
                        Save Free Shipping
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Product Voucher Modal -->
    <div class="modal fade" id="productVoucherModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="productVoucherModalTitle">Add New Product Voucher</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="productVoucherForm">
                        <input type="hidden" id="productVoucherId">
                        
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="productVoucherCode" class="form-label">Voucher Code *</label>
                                    <input type="text" class="form-control" id="productVoucherCode" required placeholder="e.g., LAPTOP20" style="text-transform: uppercase;">
                                    <div class="form-text">Unique code for customers to use</div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="productVoucherName" class="form-label">Voucher Name *</label>
                                    <input type="text" class="form-control" id="productVoucherName" required placeholder="e.g., Laptop Discount 20%">
                                </div>
                            </div>
                        </div>

                        <div class="mb-3">
                            <label for="productVoucherDescription" class="form-label">Description</label>
                            <textarea class="form-control" id="productVoucherDescription" rows="3" placeholder="Brief description of the product voucher"></textarea>
                        </div>

                        <div class="row">
                            <div class="col-md-4">
                                <div class="mb-3">
                                    <label for="productVoucherType" class="form-label">Discount Type *</label>
                                    <select class="form-control" id="productVoucherType" required onchange="toggleDiscountFields()">
                                        <option value="">Select Type</option>
                                        <option value="percentage">Percentage (%)</option>
                                        <option value="fixed_amount">Fixed Amount (Rp)</option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="mb-3">
                                    <label for="productVoucherValue" class="form-label">Discount Value *</label>
                                    <input type="number" class="form-control" id="productVoucherValue" required min="0" placeholder="e.g., 20">
                                    <div class="form-text" id="discountValueHint">Enter discount value</div>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="mb-3">
                                    <label for="productVoucherMaxDiscount" class="form-label">Max Discount (Rp)</label>
                                    <input type="number" class="form-control" id="productVoucherMaxDiscount" min="0" placeholder="Leave empty for no limit">
                                    <div class="form-text">For percentage discounts only</div>
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="productVoucherTargetType" class="form-label">Target Type *</label>
                                    <select class="form-control" id="productVoucherTargetType" required onchange="toggleTargetFields()">
                                        <option value="">Select Target</option>
                                        <option value="category">Category</option>
                                        <option value="product">Specific Product</option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="productVoucherTarget" class="form-label">Target Selection *</label>
                                    <select class="form-control" id="productVoucherTarget" required>
                                        <option value="">Select target first</option>
                                    </select>
                                    <div class="form-text" id="targetHint">Choose category or product</div>
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-4">
                                <div class="mb-3">
                                    <label for="productVoucherMinPurchase" class="form-label">Min Purchase (Rp)</label>
                                    <input type="number" class="form-control" id="productVoucherMinPurchase" min="0" placeholder="0">
                                    <div class="form-text">Minimum order value</div>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="mb-3">
                                    <label for="productVoucherUsageLimit" class="form-label">Usage Limit</label>
                                    <input type="number" class="form-control" id="productVoucherUsageLimit" min="0" placeholder="Leave empty for unlimited">
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="mb-3">
                                    <label for="productVoucherUserLimit" class="form-label">Per User Limit</label>
                                    <input type="number" class="form-control" id="productVoucherUserLimit" min="0" placeholder="1" value="1">
                                    <div class="form-text">Max uses per customer</div>
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="productVoucherStartDate" class="form-label">Start Date *</label>
                                    <input type="date" class="form-control" id="productVoucherStartDate" required>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="productVoucherEndDate" class="form-label">End Date</label>
                                    <input type="date" class="form-control" id="productVoucherEndDate">
                                    <div class="form-text">Leave empty for no expiry</div>
                                </div>
                            </div>
                        </div>

                        <div class="mb-3">
                            <label for="productVoucherStatus" class="form-label">Status</label>
                            <select class="form-control" id="productVoucherStatus">
                                <option value="1">Active</option>
                                <option value="0">Inactive</option>
                            </select>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" onclick="saveProductVoucher()" id="saveProductVoucherBtn">
                        <span class="spinner-border spinner-border-sm d-none me-2" id="productVoucherSaveSpinner"></span>
                        Save Product Voucher
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Container for dynamically injected modals -->
    <div id="modalsContainer"></div>
    <script src="script.js?v=2"></script>

    <!-- BEST SELLERS: Load all products from admin products table so admin can toggle "Tampilkan di User" -->
    <script>
      // Currency formatter for IDR
      const fmtIDR = new Intl.NumberFormat('id-ID', { style: 'currency', currency: 'IDR', minimumFractionDigits: 0 });

      function getBestSellersToken() {
        try {
          return (
            localStorage.getItem('auth_token') ||
            localStorage.getItem('authToken') ||
            localStorage.getItem('token') ||
            localStorage.getItem('adminToken') ||
            sessionStorage.getItem('auth_token') ||
            sessionStorage.getItem('adminToken')
          );
        } catch (_) { return null; }
      }

      async function fetchWithFallback(url, options) {
        let res = await fetch(url, options).catch(() => null);
        if (!(res && res.ok)) {
          const alt = url.startsWith('/index.php') ? url.replace('/index.php', '') : `/index.php${url}`;
          res = await fetch(alt, options).catch(() => null);
        }
        return res && res.ok ? res : null;
      }

      async function loadBestSellersProducts(){
        const tbody = document.getElementById('bestSellersTableBody');
        const wrap = document.querySelector('#best-sellers .table-responsive');
        if (tbody) {
          tbody.innerHTML = '<tr><td colspan="5" class="text-center py-4 text-muted"><i class="fas fa-spinner fa-spin me-2"></i>Memuat produk...</td></tr>';
        }
        if (wrap) wrap.classList.remove('d-none');

        const token = getBestSellersToken();
        if (!token) {
          if (tbody) tbody.innerHTML = '<tr><td colspan="5" class="text-center py-4 text-danger">Sesi login berakhir. Silakan login ulang.</td></tr>';
          return;
        }

        const headers = { 'Authorization': `Bearer ${token}` };

        // 1. Ambil semua produk dari admin API
        const productsRes = await fetchWithFallback('/api/products?limit=500', { headers });
        if (!productsRes) {
          if (tbody) tbody.innerHTML = '<tr><td colspan="5" class="text-center py-4 text-danger">Gagal memuat daftar produk.</td></tr>';
          return;
        }

        let products = [];
        try {
          const json = await productsRes.json();
          products = Array.isArray(json?.data) ? json.data : (Array.isArray(json) ? json : []);
        } catch (e) {
          console.warn('[BestSellers] gagal parse products', e);
        }

        if (!products.length) {
          if (tbody) tbody.innerHTML = '<tr><td colspan="5" class="text-center py-4 text-warning">Belum ada produk. Tambahkan produk terlebih dahulu.</td></tr>';
          return;
        }

        // 2. Ambil daftar featured saat ini
        let featuredIds = new Set();
        const featuredRes = await fetchWithFallback('/api/featured-products', { headers });
        if (featuredRes) {
          try {
            const fj = await featuredRes.json();
            const ids = Array.isArray(fj?.data) ? fj.data : [];
            featuredIds = new Set(ids.map(id => String(id)));
          } catch (e) {
            console.warn('[BestSellers] gagal parse featured ids', e);
          }
        }

        let enableFeaturedToggle = true;
        try {
          if (typeof window.hasAccessToSection === 'function') {
            enableFeaturedToggle = !!window.hasAccessToSection('best-sellers');
          }
        } catch (_) {}

        const rows = products.map(p => {
          const id = String(p.id ?? '');
          const name = p.name || '-';
          const category = p.category || '-';
          const price = Number(p.regular_price ?? 0);
          const stock = Number.isFinite(+p.stock) ? parseInt(p.stock, 10) : 0;

          let img = '';
          if (Array.isArray(p.images) && p.images.length) {
            img = String(p.images[0]);
          } else if (p.product_image) {
            img = String(p.product_image);
          }
          if (img && !img.startsWith('http')) {
            img = img.startsWith('/') ? img : '/' + img;
          }
          if (!img) {
            img = "data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='48' height='48'><rect width='100%' height='100%' fill='%23f3f4f6'/><text x='50%' y='50%' dominant-baseline='middle' text-anchor='middle' fill='%239ca3af' font-size='9'>No Img</text></svg>";
          }

          const isFeatured = featuredIds.has(id);
          const btnClass = isFeatured ? 'btn-success' : 'btn-outline-secondary';
          const btnText = isFeatured ? 'Ditampilkan' : 'Tampilkan di User';

          return `
            <tr>
              <td>
                <div class="d-flex align-items-center" style="gap:10px;">
                  <img src="${img}" alt="${name}" style="width:48px;height:48px;object-fit:cover;border-radius:6px;border:1px solid #e5e7eb;background:#f9fafb;">
                  <div>
                    <div class="fw-semibold">${name}</div>
                    <small class="text-muted">ID: ${id}</small>
                  </div>
                </div>
              </td>
              <td>${category}</td>
              <td>${fmtIDR.format(price)}</td>
              <td>${stock}</td>
              <td class="text-center">${enableFeaturedToggle
                ? `<button class="btn btn-sm ${btnClass}" onclick="toggleFeaturedProduct('${id}')"><i class='fas fa-bullhorn me-1'></i>${btnText}</button>`
                : '<span class="text-muted">-</span>'}</td>
            </tr>
          `;
        }).join('');

        if (wrap) {
          wrap.innerHTML = `
            <table class="table table-bordered align-middle" id="bestSellersTable">
              <thead>
                <tr>
                  <th>Produk</th>
                  <th>Kategori</th>
                  <th>Harga</th>
                  <th>Stok</th>
                  <th class="text-center">Aksi</th>
                </tr>
              </thead>
              <tbody id="bestSellersTableBody">${rows}</tbody>
            </table>`;
        } else if (tbody) {
          tbody.innerHTML = rows;
        }
      }

      async function toggleFeaturedProduct(id){
        const token = getBestSellersToken();
        if (!token) { alert('Sesi login berakhir. Silakan login ulang.'); return; }
        const headers = { 'Authorization': `Bearer ${token}` };
        const btn = document.querySelector(`#bestSellersTableBody button[onclick*="toggleFeaturedProduct('${id}')"]`);
        const isOn = btn && btn.classList.contains('btn-success');

        try {
          if (isOn) {
            const res = await fetchWithFallback(`/api/featured-products/${id}`, { method: 'DELETE', headers });
            if (!res) throw new Error('Gagal menghapus dari featured');
          } else {
            const res = await fetchWithFallback('/api/featured-products', {
              method: 'POST',
              headers: { ...headers, 'Content-Type': 'application/json' },
              body: JSON.stringify({ product_id: Number(id) })
            });
            if (!res) throw new Error('Gagal menambahkan ke featured');
          }
          loadBestSellersProducts();
        } catch (e) {
          alert(e?.message || 'Terjadi kesalahan');
        }
      }

      // Auto-load when best-sellers section becomes visible
      (function(){
        const sec = document.getElementById('best-sellers');
        if (!sec) return;
        const obs = new MutationObserver((muts) => {
          muts.forEach(m => {
            if (m.type === 'attributes' && m.attributeName === 'style'){
              if (!sec.style.display || !sec.style.display.includes('none')){
                loadBestSellersProducts();
              }
            }
          });
        });
        obs.observe(sec, { attributes: true, attributeFilter:['style'] });
        // If already visible, load immediately after a short delay
        setTimeout(() => { if (!sec.style.display || !sec.style.display.includes('none')) loadBestSellersProducts(); }, 800);
      })();

      // Expose manual refresh if needed
      window.loadBestSellersProducts = loadBestSellersProducts;
      window.toggleFeaturedProduct = toggleFeaturedProduct;

      // Do not autoload on DOMContentLoaded directly; only when section visible
    </script>


    <!-- Access Denied Modal -->
    <div class="modal fade" id="accessDeniedModal" tabindex="-1" aria-labelledby="accessDeniedModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header bg-danger text-white">
                    <h5 class="modal-title" id="accessDeniedModalLabel">
                        <i class="fas fa-exclamation-triangle me-2"></i>Akses Ditolak
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body text-center">
                    <div class="mb-4">
                        <i class="fas fa-lock fa-4x text-danger mb-3"></i>
                        <h4>Maaf, Anda tidak memiliki izin</h4>
                        <p class="text-muted">
                            Anda tidak memiliki izin untuk mengakses halaman <strong><span id="deniedSectionName">ini</span></strong>.
                        </p>
                        <div class="alert alert-warning">
                            <strong>Role Anda:</strong> <span id="currentUserRole">-</span><br>
                            <small>Hubungi administrator untuk mendapatkan akses yang diperlukan.</small>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                        <i class="fas fa-arrow-left me-2"></i>Kembali
                    </button>
                    <button type="button" class="btn btn-primary" onclick="showSection('dashboard')" data-bs-dismiss="modal">
                        <i class="fas fa-home me-2"></i>Ke Dashboard
                    </button>
                </div>
            </div>
        </div>
    </div>
  <!-- Pending Customers Banner & Modal (Auto-added) -->
  <div id="pendingCustomersBanner" style="display:none; position:fixed; top:16px; right:16px; z-index:9999; background:#fff4e5; color:#7a3e00; border:1px solid #ffc58b; padding:10px 14px; border-radius:8px; box-shadow:0 2px 10px rgba(0,0,0,0.1);">
    <span id="pendingCustomersText">Ada pelanggan menunggu persetujuan</span>
    <button id="openPendingCustomersBtn" style="margin-left:8px; background:#e11d48; color:#fff; border:none; padding:6px 10px; border-radius:6px; cursor:pointer;">Review</button>
  </div>

  <div id="pendingCustomersModal" style="display:none; position:fixed; inset:0; background:rgba(0,0,0,0.45); z-index:10000;">
    <div style="position:absolute; top:50%; left:50%; transform:translate(-50%,-50%); width:90%; max-width:900px; background:#ffffff; border-radius:10px; overflow:hidden;">
      <div style="padding:12px 16px; background:#111827; color:#fff; display:flex; align-items:center; justify-content:space-between;">
        <strong>Pending Customers</strong>
        <button id="closePendingCustomersBtn" style="background:transparent; color:#fff; border:1px solid #374151; padding:4px 8px; border-radius:6px; cursor:pointer;">Tutup</button>
      </div>
      <div style="padding:12px 16px; max-height:70vh; overflow:auto;">
        <table style="width:100%; border-collapse:collapse;">
          <thead>
            <tr style="text-align:left; border-bottom:1px solid #e5e7eb;">
              <th style="padding:8px;">ID</th>
              <th style="padding:8px;">Nama</th>
              <th style="padding:8px;">Email</th>
              <th style="padding:8px;">Status</th>
              <th style="padding:8px;">Aksi</th>
            </tr>
          </thead>
          <tbody id="pendingCustomersTbody"></tbody>
        </table>
      </div>
    </div>
  </div>

  <script>
    (function(){
      const banner = document.getElementById('pendingCustomersBanner');
      const text = document.getElementById('pendingCustomersText');
      const openBtn = document.getElementById('openPendingCustomersBtn');
      const modal = document.getElementById('pendingCustomersModal');
      const closeBtn = document.getElementById('closePendingCustomersBtn');
      const tbody = document.getElementById('pendingCustomersTbody');

      function getToken(){
        try {
          return (
            localStorage.getItem('auth_token') ||
            localStorage.getItem('authToken') ||
            localStorage.getItem('token') ||
            localStorage.getItem('adminToken') ||
            sessionStorage.getItem('auth_token') ||
            sessionStorage.getItem('adminToken')
          );
        } catch (e) { return null; }
      }

      async function apiGet(path){
        const token = getToken();
        const res = await fetch(path, { headers: { 'Authorization': token ? 'Bearer ' + token : '' }});
        return res.json();
      }

      async function apiPut(path, body){
        const token = getToken();
        const res = await fetch(path, {
          method: 'PUT',
          headers: { 'Content-Type': 'application/json', 'Authorization': token ? 'Bearer ' + token : '' },
          body: JSON.stringify(body || {})
        });
        return res.json();
      }

      async function refreshPendingCount(){
        try {
          const data = await apiGet('/api/customers/pending/count');
          const count = data && data.count ? Number(data.count) : 0;
          if (count > 0){
            text.textContent = `Ada ${count} pelanggan menunggu persetujuan`;
            banner.style.display = 'block';
          } else {
            banner.style.display = 'none';
          }
        } catch (e) {
          // ignore errors silently to not disturb UI
        }
      }

      async function openModal(){
        modal.style.display = 'block';
        tbody.innerHTML = '<tr><td colspan="5" style="padding:10px; color:#6b7280;">Memuat...</td></tr>';
        try {
          const data = await apiGet('/api/customers?status=inactive');
          const rows = (data && data.data) ? data.data : [];
          if (!rows.length){
            tbody.innerHTML = '<tr><td colspan="5" style="padding:10px; color:#6b7280;">Tidak ada data</td></tr>';
            return;
          }
          tbody.innerHTML = rows.map(r => `
            <tr style="border-bottom:1px solid #e5e7eb;">
              <td style="padding:8px;">${r.id ?? ''}</td>
              <td style="padding:8px;">${r.name ?? ''}</td>
              <td style="padding:8px;">${r.email ?? ''}</td>
              <td style="padding:8px; text-transform:capitalize;">${r.status ?? ''}</td>
              <td style="padding:8px;">
                <button data-id="${r.id}" class="approve-btn" style="background:#16a34a; color:#fff; border:none; padding:6px 10px; border-radius:6px; cursor:pointer;">Approve</button>
              </td>
            </tr>
          `).join('');
          tbody.querySelectorAll('.approve-btn').forEach(btn => {
            btn.addEventListener('click', async (ev) => {
              const id = ev.currentTarget.getAttribute('data-id');
              ev.currentTarget.disabled = true;
              ev.currentTarget.textContent = 'Processing...';
              try {
                const res = await apiPut(`/api/customers/${id}/status`, { status: 'active' });
                await refreshPendingCount();
                await openModal(); // reload list
              } catch (e) {
                ev.currentTarget.disabled = false;
                ev.currentTarget.textContent = 'Approve';
                alert('Gagal approve, coba lagi.');
              }
            });
          });
        } catch (e) {
          tbody.innerHTML = '<tr><td colspan="5" style="padding:10px; color:#b91c1c;">Gagal memuat data</td></tr>';
        }
      }

      function closeModal(){ modal.style.display = 'none'; }

      if (openBtn) openBtn.addEventListener('click', openModal);
      if (closeBtn) closeBtn.addEventListener('click', closeModal);
      modal.addEventListener('click', (e) => { if (e.target === modal) closeModal(); });

      // Initial fetch & polling every 30s
      refreshPendingCount();
      setInterval(refreshPendingCount, 30000);
    })();
  </script>

</body>
</html>
